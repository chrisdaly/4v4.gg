import{r as s,b as z,d as I,e as V,c as F,f as X,j as e,P as Y,h as Z,B as M,S as v,i as L,k as _}from"./index-6R-bl_KJ.js";import{G as ee}from"./GameCard-6sJTQuHU.js";/* empty css                 */import"./formatters-C0HfR3L6.js";function ae(n,d){const j=new Date(n);return(new Date-j)/(1e3*60)<d}const w=[{label:"30 min",minutes:30,pageSize:50},{label:"1 hour",minutes:60,pageSize:75},{label:"2 hours",minutes:120,pageSize:100},{label:"4 hours",minutes:240,pageSize:150},{label:"8 hours",minutes:480,pageSize:200}],$=[{label:"All",min:0,max:1/0},{label:"< 10 min",min:0,max:10},{label:"10-20 min",min:10,max:20},{label:"20-30 min",min:20,max:30},{label:"> 30 min",min:30,max:1/0}],k=[{label:"All",min:0,max:1/0},{label:"< 1500",min:0,max:1500},{label:"1500-1700",min:1500,max:1700},{label:"1700-1900",min:1700,max:1900},{label:"1900+",min:1900,max:1/0}],te=n=>{const d=z("finishedMatches",{timeRangeIndex:n,gateway:_,gameMode:L});return I.get(d)},ce=()=>{const n=te(0),[d,j]=s.useState((n==null?void 0:n.sortedMatches)||null),[i,S]=s.useState((n==null?void 0:n.matchesData)||null),[B,b]=s.useState(!n),[c,E]=s.useState("all"),[h,A]=s.useState(0),[u,C]=s.useState(0),[N,K]=s.useState(0),[o,g]=s.useState(1),R=20;s.useEffect(()=>{O()},[N]),s.useEffect(()=>{g(1)},[c,h,u]);const O=async()=>{const a=w[N],t=z("finishedMatches",{timeRangeIndex:N,gateway:_,gameMode:L}),l=I.get(t);if(l){j(l.sortedMatches),S(l.matchesData),b(!1);return}i||b(!0);try{const m=(await V(a.pageSize,0)).matches.filter(p=>ae(p.endTime,a.minutes)).slice().sort((p,H)=>{const Q=F(p.teams);return F(H.teams)-Q});j(m);const q=m.map(p=>X(p.id)),G=await Promise.all(q);S(G),I.set(t,{sortedMatches:m,matchesData:G},120*1e3),b(!1)}catch(x){console.error("Error fetching match data:",x.message),b(!1)}},W=s.useMemo(()=>{if(!i)return[];const a=new Set;return i.forEach(t=>{var l;(l=t.match)!=null&&l.mapName&&a.add(t.match.mapName)}),Array.from(a).sort()},[i]),f=s.useMemo(()=>i?i.filter(a=>{const t=a.match;if(c!=="all"&&t.mapName!==c)return!1;const l=$[h],x=t.durationInSeconds/60;if(x<l.min||x>=l.max)return!1;const D=k[u],m=F(t.teams);return!(m<D.min||m>=D.max)}):[],[i,c,h,u]),J=()=>{E("all"),A(0),C(0)},U=c!=="all"||h!==0||u!==0,r=Math.ceil(f.length/R),y=(o-1)*R,P=y+R,T=f.slice(y,P);return e.jsx(e.Fragment,{children:B?e.jsx("div",{className:"page-loader",children:e.jsx(Y,{})}):i?e.jsxs(Z,{maxWidth:"1200px",header:e.jsxs("div",{className:"finished-header",children:[e.jsxs("div",{className:"finished-title-section",children:[e.jsx("h1",{className:"finished-title",children:"Recently Finished"}),e.jsx("div",{className:"finished-stats",children:e.jsxs("span",{className:"stat-item",children:[f.length," games",r>1&&` · Page ${o} of ${r}`]})})]}),e.jsxs("div",{className:"finished-controls",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Time Range"}),e.jsx(v,{value:N,onChange:a=>K(Number(a.target.value)),children:w.map((a,t)=>e.jsxs("option",{value:t,children:["Last ",a.label]},t))})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Map"}),e.jsxs(v,{value:c,onChange:a=>E(a.target.value),children:[e.jsx("option",{value:"all",children:"All Maps"}),W.map(a=>e.jsx("option",{value:a,children:a},a))]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Duration"}),e.jsx(v,{value:h,onChange:a=>A(Number(a.target.value)),children:$.map((a,t)=>e.jsx("option",{value:t,children:a.label},t))})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Avg MMR"}),e.jsx(v,{value:u,onChange:a=>C(Number(a.target.value)),children:k.map((a,t)=>e.jsx("option",{value:t,children:a.label},t))})]}),U&&e.jsx(M,{$ghost:!0,className:"clear-filters",onClick:J,children:"Clear"})]})]}),children:[e.jsx("div",{className:"game-tiles",children:T.length>0?T.map(a=>e.jsx(ee,{game:a},a.match.id)):e.jsx("div",{className:"no-results",children:"No matches found with current filters"})}),r>1&&e.jsxs("div",{className:"pagination",children:[e.jsx(M,{$secondary:!0,className:"pagination-btn",onClick:()=>g(1),disabled:o===1,children:"««"}),e.jsx(M,{$secondary:!0,className:"pagination-btn",onClick:()=>g(a=>Math.max(1,a-1)),disabled:o===1,children:"«"}),e.jsxs("span",{className:"pagination-info",children:[y+1,"-",Math.min(P,f.length)," of ",f.length]}),e.jsx(M,{$secondary:!0,className:"pagination-btn",onClick:()=>g(a=>Math.min(r,a+1)),disabled:o===r,children:"»"}),e.jsx(M,{$secondary:!0,className:"pagination-btn",onClick:()=>g(r),disabled:o===r,children:"»»"})]})]}):e.jsxs("div",{children:["Error: Failed to load match data",e.jsx("p",{children:JSON.stringify(d)})]})})};export{ce as default};
