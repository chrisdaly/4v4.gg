import{r as o,J as v,d as x,j as a,P as S,f as F,g as L,K as C}from"./index-6R-bl_KJ.js";import{G as O}from"./Game-B1z5RLXK.js";import{e as U,O as N}from"./OngoingGame-B9FCbogl.js";import"./index-DTdtBFkc.js";import"./iconBase-V32KN-Z0.js";import"./MmrComparison-q21iWuSw.js";import"./formatters-C0HfR3L6.js";import"./FormDots-DxrKurhi.js";import"./twitchService-D5TnHh44.js";const R=t=>x.get(`finishedMatchPlayers:${t}`),$=({data:t,compact:n=!1})=>{var y;const i=(y=t==null?void 0:t.match)==null?void 0:y.id,e=i?R(i):null,[m,h]=o.useState((e==null?void 0:e.playerData)||null),[f,u]=o.useState((e==null?void 0:e.metaData)||null),[s,g]=o.useState((e==null?void 0:e.profilePics)||{}),[d,D]=o.useState((e==null?void 0:e.countries)||{}),[M,w]=o.useState((e==null?void 0:e.sessions)||{}),[E,p]=o.useState(!e&&!n);o.useEffect(()=>{I()},[]);const I=async()=>{try{if(!t)throw new Error("Invalid match data format");const l=v(t.match,t.playerScores),{playerData:r,metaData:c}=l;h(r),u({...c,matchId:t.match.id}),n?p(!1):(e||p(!0),await G(r))}catch(l){console.error("Error fetching match data:",l.message),p(!1)}},G=async l=>{try{const r=await U(l,{fetchSessions:!0,fetchTwitchStatus:!1});g(c=>({...c,...r.profilePics})),D(c=>({...c,...r.countries})),w(c=>({...c,...r.sessions})),i&&x.set(`finishedMatchPlayers:${i}`,{playerData:l,metaData:{...f,matchId:i},profilePics:r.profilePics,countries:r.countries,sessions:r.sessions},1800*1e3)}catch(r){console.error("Error fetching player data:",r)}finally{p(!1)}};return a.jsx(a.Fragment,{children:E?a.jsx("div",{className:"page-loader",children:a.jsx(S,{})}):m?a.jsx(O,{playerData:m,metaData:f,profilePics:s,playerCountries:d,sessionData:M,compact:n}):a.jsx("div",{children:"Error: Failed to load match data"})})},j=()=>new URL(window.location.href).pathname.split("/").slice(-1)[0],P=()=>{const t=j(),n=C(t);return n!=null&&n.match?n:null},H=()=>{const[t,n]=o.useState(P),[i,e]=o.useState(null),[m,h]=o.useState(()=>P()===null);o.useEffect(()=>{f()},[]);const f=async()=>{const u=j();try{const s=await F(u);if(s!=null&&s.match){n(s),h(!1);return}}catch(s){console.error("Error fetching finished match:",s.message)}try{const s=await L(),g=((s==null?void 0:s.matches)||[]).find(d=>d.id===u);if(g){e(g),h(!1);return}}catch(s){console.error("Error fetching ongoing matches:",s.message)}h(!1)};return a.jsx("div",{className:"match-page",children:m?a.jsx("div",{className:"page-loader",children:a.jsx(S,{})}):t!=null&&t.match?a.jsx($,{data:t}):i?a.jsx(N,{ongoingGameData:i}):a.jsx("div",{children:"Error: Failed to load match data"})})};export{H as default};
