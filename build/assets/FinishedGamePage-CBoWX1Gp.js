import{a as o,v as R,m as $,l as k,f as I,j as a,G as q,w as z,d as A,O as B,x as H}from"./index-DRkeA8z1.js";const J=s=>I.get(`finishedMatchPlayers:${s}`),K=({data:s,compact:i=!1})=>{var w;const l=(w=s==null?void 0:s.match)==null?void 0:w.id,e=l?J(l):null,[m,f]=o.useState((e==null?void 0:e.playerData)||null),[g,u]=o.useState((e==null?void 0:e.metaData)||null),[r,p]=o.useState((e==null?void 0:e.profilePics)||{}),[x,F]=o.useState((e==null?void 0:e.countries)||{}),[G,L]=o.useState((e==null?void 0:e.sessions)||{}),[U,y]=o.useState(!e&&!i);o.useEffect(()=>{N()},[]);const N=async()=>{try{const c=C(s),{playerData:h,metaData:d}=c;f(h),u({...d,matchId:s.match.id}),i?y(!1):(e||y(!0),await b(h))}catch(c){console.error("Error fetching match data:",c.message),y(!1)}},C=c=>{if(!c)throw new Error("Invalid match data format");return R(c.match,c.playerScores)},b=async c=>{try{const h=c.map(async t=>{const{battleTag:n,race:P,location:O}=t,[D,T]=await Promise.all([$(n),k(n,P)]);return{...t,profilePicUrl:D.profilePicUrl,country:D.country||O,sessionInfo:T}}),d=await Promise.all(h),j=d.reduce((t,n)=>(t[n.battleTag]=n.profilePicUrl,t),{}),M=d.reduce((t,n)=>(t[n.battleTag]=n.country,t),{}),S=d.reduce((t,n)=>{var P;return t[n.battleTag]=(P=n.sessionInfo)==null?void 0:P.session,t},{});p(t=>({...t,...j})),F(t=>({...t,...M})),L(t=>({...t,...S})),l&&I.set(`finishedMatchPlayers:${l}`,{playerData:c,metaData:{...g,matchId:l},profilePics:j,countries:M,sessions:S},1800*1e3)}catch(h){console.error("Error fetching player data:",h)}finally{y(!1)}};return a.jsx(a.Fragment,{children:U?a.jsxs("div",{className:"page-loader",children:[a.jsx("div",{className:"loader-spinner lg"}),a.jsx("span",{className:"loader-text",children:"Loading match data"})]}):m?a.jsx(q,{playerData:m,metaData:g,profilePics:r,playerCountries:x,sessionData:G,compact:i}):a.jsx("div",{children:"Error: Failed to load match data"})})},v=()=>new URL(window.location.href).pathname.split("/").slice(-1)[0],E=()=>{const s=v(),i=H(s);return i!=null&&i.match?i:null},V=()=>{const[s,i]=o.useState(E),[l,e]=o.useState(null),[m,f]=o.useState(()=>E()===null);o.useEffect(()=>{g()},[]);const g=async()=>{const u=v();try{const r=await z(u);if(r!=null&&r.match){i(r),f(!1);return}}catch(r){console.error("Error fetching finished match:",r.message)}try{const r=await A(),p=((r==null?void 0:r.matches)||[]).find(x=>x.id===u);if(p){e(p),f(!1);return}}catch(r){console.error("Error fetching ongoing matches:",r.message)}f(!1)};return a.jsx(a.Fragment,{children:m?a.jsxs("div",{className:"page-loader",children:[a.jsx("div",{className:"loader-spinner lg"}),a.jsx("span",{className:"loader-text",children:"Loading match data"})]}):s!=null&&s.match?a.jsx(K,{data:s}):l?a.jsx(B,{ongoingGameData:l}):a.jsx("div",{children:"Error: Failed to load match data"})})};export{V as default};
