import{s as I,q as L,r as a,H as j,d as g,j as b}from"./index-BHAZrgI6.js";import{G as C}from"./Game-CWbl87Gw.js";import{g as U}from"./twitchService-D5TnHh44.js";const d=async(r,x={})=>{var w;const{fetchSessions:f=!0,fetchTwitchStatus:c=!1}=x,t=r.map(async s=>{const{battleTag:i,race:n,location:l}=s,S=[I(i)];f&&S.push(L(i));const T=await Promise.all(S),y=T[0],v=f?T[1]:null;return{...s,profilePicUrl:y.profilePicUrl,twitch:y.twitch,country:y.country||l,sessionInfo:v}}),o=await Promise.all(t),P={},u={},h={};for(const s of o)P[s.battleTag]=s.profilePicUrl,u[s.battleTag]=s.country,f&&(h[s.battleTag]=(w=s.sessionInfo)==null?void 0:w.session);let p={};if(c){const s=o.filter(i=>i.twitch).map(i=>i.twitch);if(s.length>0){const i=await U(s);for(const n of o)if(n.twitch){const l=i.get(n.twitch.toLowerCase());l&&(p[n.battleTag]={...l,twitchName:n.twitch})}}}return{profilePics:P,countries:u,sessions:h,liveStreamers:p,enrichedPlayers:o}},M=r=>g.get(`matchPlayers:${r}`),q=({ongoingGameData:r,compact:x,streamerTag:f})=>{const c=r==null?void 0:r.id,t=c?M(c):null,[o,P]=a.useState((t==null?void 0:t.playerData)||null),[u,h]=a.useState((t==null?void 0:t.metaData)||null),[p,w]=a.useState((t==null?void 0:t.profilePics)||null),[s,i]=a.useState((t==null?void 0:t.countries)||{}),[n,l]=a.useState((t==null?void 0:t.sessions)||{}),[S,T]=a.useState({}),[y,v]=a.useState(!t);a.useEffect(()=>{if(!r)return;const{playerData:m,metaData:e}=j(r);P(m),h(e),t||v(!0),E(m)},[r]);const E=async m=>{try{const e=await d(m,{fetchSessions:!0,fetchTwitchStatus:!0});w(e.profilePics),i(e.countries),l(e.sessions),T(e.liveStreamers),c&&g.set(`matchPlayers:${c}`,{playerData:m,metaData:u,profilePics:e.profilePics,countries:e.countries,sessions:e.sessions},120*1e3)}catch(e){console.error("Error fetching player data:",e)}finally{v(!1)}};return y?null:!o||!p?b.jsx("div",{children:"Error: Failed to load match data"}):b.jsx(C,{playerData:o,metaData:u,profilePics:p,playerCountries:s,sessionData:n,liveStreamers:S,compact:x,streamerTag:f})};export{q as O,d as e};
