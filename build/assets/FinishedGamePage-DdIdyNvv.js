import{r as n,N as v,Q as F,a as P,j as t,S as L,d as N,m as G,O as C,T as O}from"./index-CKqM6WhI.js";const U=s=>P.get(`finishedMatchPlayers:${s}`),R=({data:s,compact:o=!1})=>{var y;const c=(y=s==null?void 0:s.match)==null?void 0:y.id,e=c?U(c):null,[m,h]=n.useState((e==null?void 0:e.playerData)||null),[f,d]=n.useState((e==null?void 0:e.metaData)||null),[a,g]=n.useState((e==null?void 0:e.profilePics)||{}),[p,S]=n.useState((e==null?void 0:e.countries)||{}),[D,M]=n.useState((e==null?void 0:e.sessions)||{}),[w,u]=n.useState(!e&&!o);n.useEffect(()=>{E()},[]);const E=async()=>{try{if(!s)throw new Error("Invalid match data format");const l=v(s.match,s.playerScores),{playerData:r,metaData:i}=l;h(r),d({...i,matchId:s.match.id}),o?u(!1):(e||u(!0),await I(r))}catch(l){console.error("Error fetching match data:",l.message),u(!1)}},I=async l=>{try{const r=await F(l,{fetchSessions:!0,fetchTwitchStatus:!1});g(i=>({...i,...r.profilePics})),S(i=>({...i,...r.countries})),M(i=>({...i,...r.sessions})),c&&P.set(`finishedMatchPlayers:${c}`,{playerData:l,metaData:{...f,matchId:c},profilePics:r.profilePics,countries:r.countries,sessions:r.sessions},1800*1e3)}catch(r){console.error("Error fetching player data:",r)}finally{u(!1)}};return t.jsx(t.Fragment,{children:w?t.jsxs("div",{className:"page-loader",children:[t.jsx("div",{className:"loader-spinner lg"}),t.jsx("span",{className:"loader-text",children:"Loading match data"})]}):m?t.jsx(L,{playerData:m,metaData:f,profilePics:a,playerCountries:p,sessionData:D,compact:o}):t.jsx("div",{children:"Error: Failed to load match data"})})},j=()=>new URL(window.location.href).pathname.split("/").slice(-1)[0],x=()=>{const s=j(),o=O(s);return o!=null&&o.match?o:null},$=()=>{const[s,o]=n.useState(x),[c,e]=n.useState(null),[m,h]=n.useState(()=>x()===null);n.useEffect(()=>{f()},[]);const f=async()=>{const d=j();try{const a=await N(d);if(a!=null&&a.match){o(a),h(!1);return}}catch(a){console.error("Error fetching finished match:",a.message)}try{const a=await G(),g=((a==null?void 0:a.matches)||[]).find(p=>p.id===d);if(g){e(g),h(!1);return}}catch(a){console.error("Error fetching ongoing matches:",a.message)}h(!1)};return t.jsx(t.Fragment,{children:m?t.jsxs("div",{className:"page-loader",children:[t.jsx("div",{className:"loader-spinner lg"}),t.jsx("span",{className:"loader-text",children:"Loading match data"})]}):s!=null&&s.match?t.jsx(R,{data:s}):c?t.jsx(C,{ongoingGameData:c}):t.jsx("div",{children:"Error: Failed to load match data"})})};export{$ as default};
