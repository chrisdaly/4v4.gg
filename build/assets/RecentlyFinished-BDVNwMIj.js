import{r as s,b as z,d as y,e as H,c as D,f as Q,j as e,P as V,h as L,i as k}from"./index-Bn_GvsPV.js";import{G as X}from"./GameCard-6t8DtHzL.js";/* empty css                 */import"./formatters-C0HfR3L6.js";function Y(n,d){const j=new Date(n);return(new Date-j)/(1e3*60)<d}const T=[{label:"30 min",minutes:30,pageSize:50},{label:"1 hour",minutes:60,pageSize:75},{label:"2 hours",minutes:120,pageSize:100},{label:"4 hours",minutes:240,pageSize:150},{label:"8 hours",minutes:480,pageSize:200}],G=[{label:"All",min:0,max:1/0},{label:"< 10 min",min:0,max:10},{label:"10-20 min",min:10,max:20},{label:"20-30 min",min:20,max:30},{label:"> 30 min",min:30,max:1/0}],w=[{label:"All",min:0,max:1/0},{label:"< 1500",min:0,max:1500},{label:"1500-1700",min:1500,max:1700},{label:"1700-1900",min:1700,max:1900},{label:"1900+",min:1900,max:1/0}],Z=n=>{const d=z("finishedMatches",{timeRangeIndex:n,gateway:k,gameMode:L});return y.get(d)},ie=()=>{const n=Z(0),[d,j]=s.useState((n==null?void 0:n.sortedMatches)||null),[i,N]=s.useState((n==null?void 0:n.matchesData)||null),[_,M]=s.useState(!n),[r,F]=s.useState("all"),[h,I]=s.useState(0),[u,E]=s.useState(0),[b,K]=s.useState(0),[o,g]=s.useState(1),v=20;s.useEffect(()=>{B()},[b]),s.useEffect(()=>{g(1)},[r,h,u]);const B=async()=>{const a=T[b],t=z("finishedMatches",{timeRangeIndex:b,gateway:k,gameMode:L}),l=y.get(t);if(l){j(l.sortedMatches),N(l.matchesData),M(!1);return}i||M(!0);try{const m=(await H(a.pageSize,0)).matches.filter(p=>Y(p.endTime,a.minutes)).slice().sort((p,U)=>{const q=D(p.teams);return D(U.teams)-q});j(m);const J=m.map(p=>Q(p.id)),P=await Promise.all(J);N(P),y.set(t,{sortedMatches:m,matchesData:P},120*1e3),M(!1)}catch(f){console.error("Error fetching match data:",f.message),M(!1)}},O=s.useMemo(()=>{if(!i)return[];const a=new Set;return i.forEach(t=>{var l;(l=t.match)!=null&&l.mapName&&a.add(t.match.mapName)}),Array.from(a).sort()},[i]),x=s.useMemo(()=>i?i.filter(a=>{const t=a.match;if(r!=="all"&&t.mapName!==r)return!1;const l=G[h],f=t.durationInSeconds/60;if(f<l.min||f>=l.max)return!1;const S=w[u],m=D(t.teams);return!(m<S.min||m>=S.max)}):[],[i,r,h,u]),W=()=>{F("all"),I(0),E(0)},$=r!=="all"||h!==0||u!==0,c=Math.ceil(x.length/v),R=(o-1)*v,A=R+v,C=x.slice(R,A);return e.jsx(e.Fragment,{children:_?e.jsxs("div",{className:"page-loader",children:[e.jsx("div",{className:"loader-spinner lg"}),e.jsx("span",{className:"loader-text",children:"Loading matches"})]}):i?e.jsxs(V,{maxWidth:"1200px",header:e.jsxs("div",{className:"finished-header",children:[e.jsxs("div",{className:"finished-title-section",children:[e.jsx("h1",{className:"finished-title",children:"Recently Finished"}),e.jsx("div",{className:"finished-stats",children:e.jsxs("span",{className:"stat-item",children:[x.length," games",c>1&&` · Page ${o} of ${c}`]})})]}),e.jsxs("div",{className:"finished-controls",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Time Range"}),e.jsx("select",{value:b,onChange:a=>K(Number(a.target.value)),children:T.map((a,t)=>e.jsxs("option",{value:t,children:["Last ",a.label]},t))})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Map"}),e.jsxs("select",{value:r,onChange:a=>F(a.target.value),children:[e.jsx("option",{value:"all",children:"All Maps"}),O.map(a=>e.jsx("option",{value:a,children:a},a))]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Duration"}),e.jsx("select",{value:h,onChange:a=>I(Number(a.target.value)),children:G.map((a,t)=>e.jsx("option",{value:t,children:a.label},t))})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Avg MMR"}),e.jsx("select",{value:u,onChange:a=>E(Number(a.target.value)),children:w.map((a,t)=>e.jsx("option",{value:t,children:a.label},t))})]}),$&&e.jsx("button",{className:"clear-filters",onClick:W,children:"Clear"})]})]}),children:[e.jsx("div",{className:"game-tiles",children:C.length>0?C.map(a=>e.jsx(X,{game:a},a.match.id)):e.jsx("div",{className:"no-results",children:"No matches found with current filters"})}),c>1&&e.jsxs("div",{className:"pagination",children:[e.jsx("button",{className:"pagination-btn",onClick:()=>g(1),disabled:o===1,children:"««"}),e.jsx("button",{className:"pagination-btn",onClick:()=>g(a=>Math.max(1,a-1)),disabled:o===1,children:"«"}),e.jsxs("span",{className:"pagination-info",children:[R+1,"-",Math.min(A,x.length)," of ",x.length]}),e.jsx("button",{className:"pagination-btn",onClick:()=>g(a=>Math.min(c,a+1)),disabled:o===c,children:"»"}),e.jsx("button",{className:"pagination-btn",onClick:()=>g(c),disabled:o===c,children:"»»"})]})]}):e.jsxs("div",{children:["Error: Failed to load match data",e.jsx("p",{children:JSON.stringify(d)})]})})};export{ie as default};
