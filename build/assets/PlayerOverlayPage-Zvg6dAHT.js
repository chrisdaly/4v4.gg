import{r as R,s as j,q as D,f as k,a0 as P,j as v}from"./index-Ck5R6zb5.js";import{P as C}from"./PlayerOverlay-BUmvLr8L.js";const x=async d=>{try{const s=d.toLowerCase(),c=`https://website-backend.w3champions.com/api/ladder/search?gateWay=${k}&searchFor=${encodeURIComponent(d.split("#")[0])}&gameMode=4&season=${P}`,o=await fetch(c);if(!o.ok)return null;const l=(await o.json()).find(a=>{var i,m,w,p,f,g,y;const t=(w=(m=(i=a.playersInfo)==null?void 0:i[0])==null?void 0:m.battleTag)==null?void 0:w.toLowerCase(),r=(y=(g=(f=(p=a.player)==null?void 0:p.playerIds)==null?void 0:f[0])==null?void 0:g.battleTag)==null?void 0:y.toLowerCase();return t===s||r===s});if(!l)return null;const n=l.league,h=l.rankNumber;let e=0;for(let a=0;a<n;a++)try{const t=`https://website-backend.w3champions.com/api/ladder/${a}?gateWay=${k}&gameMode=4&season=${P}`,r=await fetch(t);if(r.ok){const i=await r.json();e+=i.length}}catch{}return e+h}catch(s){return console.error("Error calculating overall rank:",s),null}},I=async d=>{const s=[0,1,2,4,8],c=[];let o=[];try{const e=await fetch("https://website-backend.w3champions.com/api/ladder/seasons");e.ok&&(o=await e.json())}catch{o=[{id:P}]}const u=[];for(const e of o)for(const a of s)u.push(fetch(`https://website-backend.w3champions.com/api/players/${encodeURIComponent(d)}/mmr-rp-timeline?gateway=${k}&season=${e.id}&race=${a}&gameMode=4`).then(t=>t.ok?t.json():null).then(t=>(t==null?void 0:t.mmrRpAtDates)||[]).catch(()=>[]));const l=await Promise.all(u);for(const e of l)c.push(...e);const n={};for(const e of c)(!n[e.date]||e.mmr>n[e.date].mmr)&&(n[e.date]=e);return Object.values(n).sort((e,a)=>new Date(e.date)-new Date(a.date)).map(e=>e.mmr)},E=()=>{const[d,s]=R.useState(!1),[c,o]=R.useState(null),u=()=>{const a=new URL(window.location.href).pathname.split("/").slice(-1)[0];return decodeURIComponent(a)},l=()=>new URLSearchParams(window.location.search).get("bg")||"bg-gradient-fade",n=()=>new URLSearchParams(window.location.search).get("layout")||"default";R.useEffect(()=>{document.documentElement.style.overflow="hidden",document.body.style.overflow="hidden"},[]),R.useEffect(()=>{h();const e=setInterval(h,3e4);return()=>clearInterval(e)},[]);const h=async()=>{try{const e=u(),a=e.split("#")[0],[t,r,i,m,w]=await Promise.all([j(e),D(e),fetch(`https://website-backend.w3champions.com/api/players/${encodeURIComponent(e)}/game-mode-stats?gateway=${k}&season=${P}`),I(e),x(e)]),p=(r==null?void 0:r.session)||{};let f=0,g=0,y=0;if(i.ok){const b=(await i.json()).find(U=>U.gameMode===4);b&&(f=b.mmr||p.currentMmr||0,g=b.wins||0,y=b.losses||0)}const $=m.length>0?Math.max(...m):null,L=m.length>0?Math.min(...m):null;o({name:a,battleTag:e,profilePic:t==null?void 0:t.profilePicUrl,country:t==null?void 0:t.country,mmr:f,allTimeLow:L,allTimePeak:$,wins:g,losses:y,sessionChange:p.mmrChange||0,form:p.form||[],rank:w}),s(!0)}catch(e){console.error("Error loading player data:",e),s(!0)}};return v.jsx("div",{style:{background:"transparent",minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"},children:d&&c&&v.jsx(C,{playerData:c,layout:n(),bgStyle:l()})})};export{E as default};
