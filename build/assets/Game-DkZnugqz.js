import{R as j,r as g,j as e,k as f,I as J,L as S,J as q,C as B,K as Q}from"./index-BS9iFwgR.js";import{F as X}from"./index-C_4mKg4k.js";import{M as Y}from"./MmrComparison-DGA4QAde.js";import{c as F,g as Z}from"./formatters-C0HfR3L6.js";import{F as D}from"./FormDots-r5f-Vk2a.js";const ee=({playerData:o,metaData:m,profilePics:M,playerCountries:T,sessionData:p,liveStreamers:u={},compact:x,streamerTag:N,initialATGroups:v})=>{const[d,R]=g.useState(v||{}),k=["mercsHired","itemsObtained","lumberCollected"],a=g.useMemo(()=>[...o.slice(0,4).reverse(),...o.slice(4)],[o]);g.useEffect(()=>{if(v)return;(async()=>{const r=await q(o);R(r)})()},[o,v]);const G=s=>s.toLowerCase()in d,E=s=>d[s.toLowerCase()]||[],y=j.useMemo(()=>{const s={};let r=1;return Object.keys(d).forEach(t=>{if(s[t])return;const n=d[t]||[];if(n.length===0)return;const l=r++;s[t]=l,n.forEach(c=>{s[c.toLowerCase()]=l})}),s},[d]),w=s=>y[s.toLowerCase()]||0,H=s=>{if(s>=a.length-1)return!1;const r=a[s],t=a[s+1];return s<4&&s+1<4||s>=4&&s+1<8?E(r.battleTag).some(c=>c.toLowerCase()===t.battleTag.toLowerCase()):!1},U=(s,r)=>{if(!N)return null;if(s.toLowerCase()===N.toLowerCase())return"streamer";const n=a.findIndex(h=>h.battleTag.toLowerCase()===N.toLowerCase());if(n===-1)return null;const l=n<4?0:1;return(r<4?0:1)===l?"ally":"opponent"},P={heroesKilled:"Heroes Killed",expGained:"Experience Gained",goldCollected:"Gold Mined",unitsProduced:"Units Produced",unitsKilled:"Units Killed",largestArmy:"Largest Army",lumberCollected:"Lumber Harvested",goldUpkeepLost:"Gold Lost to Upkeep"},K=s=>s>=90?"green-text":s>=25?"white-text":"red-text",$=(s,r,t,n)=>a.slice(t*4,(t+1)*4).map((l,c)=>{const h=l[s][r],i=K(n[t*4+c]);return e.jsx("td",{className:`${i} number team-${t}`,children:h.toLocaleString("en-US")},`team${t+1}-${c}`)}),b=s=>a[0].unitScore?Object.entries(a[0][s]).filter(([r])=>!k.includes(r)).map(([r,t])=>{const n=a.map(c=>c[s][r]);let l=Q(n);return r==="goldUpkeepLost"&&(l=l.map(c=>100-c)),e.jsxs("tr",{className:"stat-row",children:[$(s,r,0,l),e.jsx("td",{className:"th-center stat-label",children:P[r]||r}),$(s,r,1,l)]},r)}):e.jsx(e.Fragment,{}),L=s=>e.jsxs("div",{className:"hero-container",children:[e.jsx("img",{src:`/heroes/${s.icon}.jpeg`,alt:"Hero Icon",className:"hero-pic"}),e.jsx("span",{className:"hero-level",children:s.level})]}),I=()=>a[0].heroScore?e.jsxs("tr",{className:"heroes-row",children:[a.slice(0,4).map((s,r)=>e.jsx("td",{className:"hero-cell",children:e.jsx("div",{className:"heroes-wrapper",children:s.heroes.map((t,n)=>e.jsx(j.Fragment,{children:L(t)},`team0-hero-${r}-${n}`))})},`team1-hero-${r}`)),e.jsx("td",{className:"th-center stat-label",children:"Heroes"}),a.slice(4).map((s,r)=>e.jsx("td",{className:"hero-cell",children:e.jsx("div",{className:"heroes-wrapper",children:s.heroes.map((t,n)=>e.jsx(j.Fragment,{children:L(t)},`team1-hero-${r}-${n}`))})},`team2-hero-${r}`))]}):e.jsx(e.Fragment,{}),O=(s,r,t)=>{const{oldMmr:n}=s,l=p==null?void 0:p[s.battleTag];l!=null&&l.mmrChange;const c=G(s.battleTag),h=H(t),i=U(s.battleTag,t);return e.jsxs("th",{style:{position:"relative",overflow:"visible"},className:`${i?`at-${i}`:""} ${c?"is-at":""}`,children:[e.jsxs("div",{className:`playerDiv ${x?"compact":""} ${i?`at-${i}`:""} ${c?"is-at":""}`,children:[e.jsxs("div",{style:{position:"relative",display:"inline-block"},children:[M[s.battleTag]?e.jsx("img",{src:M[s.battleTag],alt:"Player Profile Pic",className:`profile-pic ${s.isMvp?"mvp":""} ${c?"at":""} ${i?`relation-${i}`:""}`}):null,T[s.battleTag]?e.jsx(B,{name:T[s.battleTag].toLowerCase(),className:`${r} flag player-flag`}):null,s.isMvp&&e.jsx("div",{className:`mvp-badge ${r}`,children:e.jsx("span",{className:"mvp-text",children:"MVP"})}),e.jsx("img",{src:f[s.race],alt:"",className:"race-overlay"})]}),e.jsxs("div",{className:"player-name-row",children:[e.jsx(S,{to:`/player/${s.battleTag.replace("#","%23")}`,children:e.jsx("h2",{children:s.name})}),u[s.battleTag]&&e.jsx("a",{href:`https://twitch.tv/${u[s.battleTag].twitchName}`,target:"_blank",rel:"noopener noreferrer",className:"twitch-link",title:u[s.battleTag].title||"Live on Twitch",children:e.jsx(X,{className:"twitch-icon",style:{fill:"#9146ff"}})})]}),e.jsx("div",{className:"player-mmr-line",children:n&&n>0?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mmr-value",children:n}),e.jsx("span",{className:"mmr-label",children:" MMR"})]}):e.jsx("span",{className:"mmr-label-muted",children:"Unranked"})}),e.jsx("div",{className:"form-dots-wrapper",children:e.jsx(D,{form:l==null?void 0:l.form,size:"small"})})]}),h&&e.jsx("div",{className:"at-connector"})]},s.battleTag)},{team1MmrArray:W,team2MmrArray:V,team1AvgMmr:_,team2AvgMmr:z}=g.useMemo(()=>{if(!a||a.length<8)return{team1MmrArray:[],team2MmrArray:[],team1AvgMmr:0,team2AvgMmr:0};const s=a.slice(0,4).map(t=>t.oldMmr),r=a.slice(4).map(t=>t.oldMmr);return{team1MmrArray:s,team2MmrArray:r,team1AvgMmr:Math.round(F(s)),team2AvgMmr:Math.round(F(r))}},[a]);if(!m||!a||a.length<8)return null;const A=a[0].won,C=a[4].won;return e.jsx("div",{className:"Game",children:e.jsxs("table",{className:`game-table ${x?"compactTable":""}`,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:" "}),e.jsx("th",{children:" "}),e.jsx("th",{children:" "}),e.jsx("th",{className:`team-0 team-header ${A?"winner":""}`,children:e.jsxs("div",{children:[e.jsxs("h2",{className:"team-name",children:[A&&e.jsx("span",{className:"winner-badge",children:"W"})," TEAM 1"]}),e.jsxs("div",{className:"team-mmr-line",children:[e.jsx("span",{className:"mmr-value",children:_}),e.jsx("span",{className:"mmr-label",children:" MMR"})]}),e.jsx("div",{className:"image-container",children:a.slice(0,4).map((s,r)=>e.jsx("img",{src:f[s.race],alt:s.race,className:"race teamHeaderRace"},r))})]})}),e.jsx("th",{className:"th-center",style:{position:"relative"},children:e.jsx("h2",{children:"VS"})}),e.jsx("th",{className:`team-1 team-header ${C?"winner":""}`,children:e.jsxs("div",{children:[e.jsxs("h2",{className:"team-name",children:["TEAM 2 ",C&&e.jsx("span",{className:"winner-badge",children:"W"})]}),e.jsxs("div",{className:"team-mmr-line",children:[e.jsx("span",{className:"mmr-value",children:z}),e.jsx("span",{className:"mmr-label",children:" MMR"})]}),e.jsx("div",{className:"image-container",children:a.slice(4).map((s,r)=>e.jsx("img",{src:f[s.race],alt:s.race,className:"race teamHeaderRace"},r))})]})}),e.jsx("th",{children:" "}),e.jsx("th",{children:" "}),e.jsx("th",{children:" "})]})}),e.jsx("thead",{children:e.jsx("tr",{children:a.map((s,r)=>{const n=`team-${r<4?0:1}`;return e.jsxs(j.Fragment,{children:[O(s,n,r),r===3&&e.jsx("th",{className:`th-center ${x?"compact":""}`,style:{position:"relative",verticalAlign:"top"},children:e.jsx("div",{className:"mmr-chart-container",children:e.jsx(Y,{data:{teamOneMmrs:W,teamTwoMmrs:V,teamOneAT:a.slice(0,4).map(l=>w(l.battleTag)),teamTwoAT:a.slice(4).map(l=>w(l.battleTag))},compact:x,atStyle:"combined",showMean:!1,showStdDev:!1})})})]},`player-${r}`)})})}),e.jsxs("tbody",{children:[a[0].unitScore?e.jsxs(e.Fragment,{children:[I(),b("heroScore"),e.jsx("tr",{className:"section-divider",children:e.jsx("td",{colSpan:9})}),b("unitScore"),e.jsx("tr",{className:"section-divider",children:e.jsx("td",{colSpan:9})}),b("resourceScore")]}):e.jsx(e.Fragment,{}),e.jsx("tr",{className:"meta",children:e.jsx("td",{colSpan:9,children:e.jsxs("div",{className:"meta-bar",children:[e.jsxs("div",{className:"meta-map-centered",children:[e.jsx("img",{src:Z(m.mapId),alt:"map",className:"meta-map-img",onError:s=>{s.target.style.display="none"}}),e.jsxs("div",{className:"meta-map-info",children:[e.jsx("span",{className:"meta-map-name",children:m.mapName}),e.jsxs("span",{className:"meta-details",children:[m.gameLength==="0:00"?J(m.startTime):m.gameLength," mins",m.gameLength==="0:00"&&e.jsx("span",{className:"live-dot"})]}),m.startTime&&m.gameLength!=="0:00"&&e.jsx("span",{className:"meta-time",children:new Date(m.startTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]}),m.matchId&&m.gameLength!=="0:00"&&e.jsxs(S,{to:`/match/${m.matchId}`,className:"meta-match-id",children:["#",m.matchId]})]})})})]})]})})},ne=j.memo(ee);export{ne as G};
