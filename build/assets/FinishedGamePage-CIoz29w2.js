import{r as o,D as v,d as P,j as a,f as G,g as L,E as N}from"./index-B9cDvMpz.js";import{G as F}from"./Game-BDtI4-Yt.js";import{e as C,O}from"./OngoingGame-w9XRC04W.js";import"./index-J7TS5Hcl.js";import"./iconBase-CcrzNptn.js";import"./MmrComparison-CRMtcurz.js";import"./formatters-C0HfR3L6.js";import"./FormDots-BtDARHkI.js";import"./twitchService-D5TnHh44.js";const U=t=>P.get(`finishedMatchPlayers:${t}`),R=({data:t,compact:n=!1})=>{var y;const i=(y=t==null?void 0:t.match)==null?void 0:y.id,e=i?U(i):null,[m,h]=o.useState((e==null?void 0:e.playerData)||null),[f,d]=o.useState((e==null?void 0:e.metaData)||null),[s,g]=o.useState((e==null?void 0:e.profilePics)||{}),[p,D]=o.useState((e==null?void 0:e.countries)||{}),[S,M]=o.useState((e==null?void 0:e.sessions)||{}),[w,u]=o.useState(!e&&!n);o.useEffect(()=>{E()},[]);const E=async()=>{try{if(!t)throw new Error("Invalid match data format");const l=v(t.match,t.playerScores),{playerData:r,metaData:c}=l;h(r),d({...c,matchId:t.match.id}),n?u(!1):(e||u(!0),await I(r))}catch(l){console.error("Error fetching match data:",l.message),u(!1)}},I=async l=>{try{const r=await C(l,{fetchSessions:!0,fetchTwitchStatus:!1});g(c=>({...c,...r.profilePics})),D(c=>({...c,...r.countries})),M(c=>({...c,...r.sessions})),i&&P.set(`finishedMatchPlayers:${i}`,{playerData:l,metaData:{...f,matchId:i},profilePics:r.profilePics,countries:r.countries,sessions:r.sessions},1800*1e3)}catch(r){console.error("Error fetching player data:",r)}finally{u(!1)}};return a.jsx(a.Fragment,{children:w?a.jsxs("div",{className:"page-loader",children:[a.jsx("div",{className:"loader-spinner lg"}),a.jsx("span",{className:"loader-text",children:"Loading match data"})]}):m?a.jsx(F,{playerData:m,metaData:f,profilePics:s,playerCountries:p,sessionData:S,compact:n}):a.jsx("div",{children:"Error: Failed to load match data"})})},j=()=>new URL(window.location.href).pathname.split("/").slice(-1)[0],x=()=>{const t=j(),n=N(t);return n!=null&&n.match?n:null},J=()=>{const[t,n]=o.useState(x),[i,e]=o.useState(null),[m,h]=o.useState(()=>x()===null);o.useEffect(()=>{f()},[]);const f=async()=>{const d=j();try{const s=await G(d);if(s!=null&&s.match){n(s),h(!1);return}}catch(s){console.error("Error fetching finished match:",s.message)}try{const s=await L(),g=((s==null?void 0:s.matches)||[]).find(p=>p.id===d);if(g){e(g),h(!1);return}}catch(s){console.error("Error fetching ongoing matches:",s.message)}h(!1)};return a.jsx("div",{className:"match-page",children:m?a.jsxs("div",{className:"page-loader",children:[a.jsx("div",{className:"loader-spinner lg"}),a.jsx("span",{className:"loader-text",children:"Loading match data"})]}):t!=null&&t.match?a.jsx(R,{data:t}):i?a.jsx(O,{ongoingGameData:i}):a.jsx("div",{children:"Error: Failed to load match data"})})};export{J as default};
