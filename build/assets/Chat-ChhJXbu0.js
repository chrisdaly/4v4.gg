import{r as s,j as e,R as ne,C as Re,v as r,k as J,t as Ie,L as oe,u as Ve,w as Fe,x as Ge,y as Xe,g as qe,z as fe,s as Je,A as Qe}from"./index-B9PX3LSb.js";import{G as Ze}from"./iconBase-DTB5qqxo.js";import{G as ge}from"./index-CIZliBNt.js";import{g as Ae,f as xe}from"./formatters-C0HfR3L6.js";import{M as We}from"./MmrComparison-BnTqQ874.js";function et(t){return Ze({attr:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{d:"M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"},child:[]}]})(t)}const he="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='iso-8859-1'?%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Generator:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20height='800px'%20width='800px'%20version='1.1'%20id='Layer_1'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20viewBox='0%200%20512%20512'%20xml:space='preserve'%3e%3cpolygon%20style='fill:%23ECF0F1;'%20points='461.354,263.687%20347.439,356.077%20257.578,220.794%20167.748,356.035%2053.864,264.199%2043.363,201.714%20158.302,294.71%20257.557,145.29%20356.833,294.71%20471.771,201.714%20'/%3e%3cg%3e%3cpolygon%20style='fill:%23F8C660;'%20points='461.354,263.636%20429.975,450.298%2085.159,450.298%2053.864,264.148%20167.748,356.049%20257.578,220.801%20347.439,356.107%20'/%3e%3ccircle%20style='fill:%23F8C660;'%20cx='257.567'%20cy='103.497'%20r='41.796'/%3e%3ccircle%20style='fill:%23F8C660;'%20cx='467.592'%20cy='184.999'%20r='33.959'/%3e%3ccircle%20style='fill:%23F8C660;'%20cx='44.408'%20cy='184.999'%20r='33.959'/%3e%3c/g%3e%3cpolygon%20style='fill:%23DF5F4E;'%20points='258.132,413.632%20220.503,360.33%20258.132,307.028%20295.76,360.33%20'/%3e%3cg%3e%3cpath%20style='fill:%23231F20;'%20d='M512,185c0-24.487-19.921-44.408-44.408-44.408S423.184,160.513,423.184,185%20c0,12.43,5.14,23.676,13.398,31.745l-77.398,62.622l-84.14-126.641c20.239-7.206,34.769-26.548,34.769-49.228%20c0-28.808-23.437-52.245-52.245-52.245c-28.808,0-52.245,23.437-52.245,52.245c0,22.675,14.524,42.013,34.754,49.223%20L155.95,279.366l-79.147-64.037c7.443-7.944,12.013-18.61,12.013-30.329c0-24.487-19.921-44.408-44.408-44.408S0,160.513,0,185%20c0,22.076,16.194,40.434,37.326,43.837l37.53,223.14c0.846,5.031,5.203,8.77,10.304,8.77h344.816c5.102,0,9.458-3.738,10.304-8.77%20l37.638-223.767C497.439,223.542,512,205.932,512,185z%20M226.22,103.498c0-17.285,14.062-31.347,31.347-31.347%20s31.347,14.062,31.347,31.347s-14.062,31.347-31.347,31.347S226.22,120.783,226.22,103.498z%20M159.885,305.039%20c2.908-0.446,5.493-2.096,7.12-4.547l90.553-136.319l90.572,136.319c1.628,2.45,4.213,4.1,7.12,4.546%20c2.907,0.443,5.868-0.355,8.155-2.206l92.643-74.956c0.233,0.063,0.465,0.127,0.699,0.186l-5.022,29.879l-101.944,82.772%20l-83.499-125.708c-1.937-2.915-5.204-4.668-8.704-4.668c-3.5,0-6.768,1.752-8.704,4.668l-83.485,125.683L63.491,258.437%20l-5.251-31.246l93.489,75.641C154.016,304.684,156.974,305.482,159.885,305.039z%20M20.898,185c0-12.964,10.546-23.51,23.51-23.51%20s23.51,10.546,23.51,23.51s-10.546,23.51-23.51,23.51S20.898,197.964,20.898,185z%20M421.137,439.849H93.998l-25.26-150.267%20l92.447,74.597c2.287,1.847,5.247,2.63,8.152,2.184c2.905-0.447,5.488-2.104,7.115-4.553l81.126-122.135l81.157,122.181%20c1.63,2.453,4.218,4.103,7.129,4.547c2.916,0.445,5.875-0.362,8.161-2.218l92.437-74.999L421.137,439.849z%20M467.592,208.51%20c-12.964,0-23.51-10.546-23.51-23.51s10.546-23.51,23.51-23.51c12.964,0,23.51,10.546,23.51,23.51S480.556,208.51,467.592,208.51z'%20/%3e%3cpath%20style='fill:%23231F20;'%20d='M266.145,301.002c-1.958-2.773-5.141-4.423-8.536-4.423c-3.395,0-6.578,1.65-8.536,4.423%20l-37.629,53.302c-2.551,3.613-2.551,8.44,0,12.052l37.629,53.302c1.958,2.773,5.141,4.423,8.536,4.423%20c3.395,0,6.578-1.65,8.536-4.423l37.629-53.302c2.551-3.613,2.551-8.44,0-12.052L266.145,301.002z%20M257.609,395.515l-24.838-35.185%20l24.838-35.185l24.838,35.185L257.609,395.515z'/%3e%3c/g%3e%3c/svg%3e",tt=r.div`
  position: relative;
  flex: 1;
  min-height: 0;
  min-width: 0;
  display: flex;
  flex-direction: column;
`,rt=r.div`
  display: flex;
  flex-direction: column;
  flex: 1;
  min-height: 0;
  min-width: 0;
  box-sizing: border-box;
  background: ${t=>{var o;return((o=t.$theme)==null?void 0:o.bg)||"rgba(10, 8, 6, 0.25)"}};
  backdrop-filter: ${t=>{var o;return((o=t.$theme)==null?void 0:o.blur)||"blur(1px)"}};
  overflow: hidden;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  border: ${t=>{var o;return((o=t.$theme)==null?void 0:o.border)||"8px solid transparent"}};
  border-image: ${t=>{var o;return((o=t.$theme)==null?void 0:o.borderImage)||'url("/frames/chat/ChatFrameBorder.png") 30 / 8px stretch'}};
  box-shadow: ${t=>{var o;return((o=t.$theme)==null?void 0:o.shadow)||"none"}};
`,ot=r.div`
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--space-4);
  border-bottom: 1px solid rgba(252, 219, 51, 0.15);
  background: ${t=>{var o;return((o=t.$theme)==null?void 0:o.headerBg)||"rgba(10, 8, 6, 0.2)"}};
  backdrop-filter: ${t=>{var o;return((o=t.$theme)==null?void 0:o.blur)||"blur(1px)"}};
  flex-shrink: 0;

  @media (max-width: 480px) {
    padding: 10px var(--space-2);
  }
`,nt=r.span`
  font-family: var(--font-display);
  font-size: var(--text-sm);
  color: var(--gold);
  letter-spacing: 1px;
`,at=r.span`
  display: flex;
  align-items: center;
  gap: 6px;
  font-family: var(--font-mono);
  font-size: var(--text-xxs);
  color: var(--grey-light);
`,it=r.span`
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: ${t=>t.$connected?"var(--green)":"var(--grey-mid)"};
  ${t=>t.$connected&&"animation: pulse 1.5s infinite;"}
`,st=r.div`
  flex: 1;
  overflow-y: auto;
  padding: var(--space-2) var(--space-4);

  @media (max-width: 768px) {
    padding: var(--space-2) var(--space-2);
  }

  &::-webkit-scrollbar {
    width: 6px;
  }
  &::-webkit-scrollbar-track {
    background: transparent;
  }
  &::-webkit-scrollbar-thumb {
    background: var(--grey-mid);
    border-radius: 3px;
  }
`,lt=r.div`
  position: relative;
  min-height: 90px;
  margin-top: 20px;
  padding-bottom: var(--space-1);

  &:first-child {
    margin-top: 0;
  }

  @media (max-width: 480px) {
    min-height: 74px;
    margin-top: 14px;
  }
`,ct=r.div`
  padding: 2px var(--space-4) 2px 84px;
  line-height: 1.375;

  @media (max-width: 480px) {
    padding-left: 66px;
  }

  &:hover {
    background: rgba(255, 255, 255, 0.02);
  }
`,dt=r.div`
  position: relative;
  padding: 2px var(--space-4) 2px 84px;
  line-height: 1.375;

  @media (max-width: 480px) {
    padding-left: 66px;
  }

  &:hover {
    background: rgba(255, 255, 255, 0.02);
  }

  &:hover > .hover-timestamp {
    opacity: 0.5;
  }
`,pt=r.span`
  position: absolute;
  right: var(--space-4);
  top: 50%;
  transform: translateY(-50%);
  font-family: var(--font-mono);
  font-size: 11px;
  color: var(--grey-light);
  opacity: 0;
  transition: opacity 0.15s;
  pointer-events: none;
`,gt=r.img`
  width: 60px;
  height: 60px;
  border-radius: var(--radius-md);
  flex-shrink: 0;

  @media (max-width: 480px) {
    width: 44px;
    height: 44px;
  }
`,me=r.img`
  width: 60px;
  height: 60px;
  box-sizing: border-box;
  border-radius: var(--radius-md);
  flex-shrink: 0;
  padding: 10px;
  background: rgba(255, 255, 255, 0.06);
  opacity: ${t=>t.$faded?.3:.85};

  @media (max-width: 480px) {
    width: 44px;
    height: 44px;
    padding: 6px;
  }
`,ht=r.div`
  min-width: 0;
`,ft=r.span`
  font-family: var(--font-mono);
  font-size: 12px;
  color: var(--grey-light);
  margin-left: var(--space-2);
`,xt=r.span`
  display: inline-flex;
  align-items: center;
`,mt=r.img`
  width: 16px;
  height: 16px;
  margin-left: 4px;
  filter: drop-shadow(0 0 4px rgba(252, 219, 51, 0.4));
`,ut=r(oe)`
  font-family: var(--font-display);
  font-size: var(--text-sm);
  color: var(--gold);
  text-decoration: none;

  &:hover {
    text-decoration: underline;
  }
`,vt=r.div`
  position: absolute;
  left: var(--space-2);
  top: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 60px;

  @media (max-width: 480px) {
    width: 44px;
  }
`,bt=r.div`
  position: relative;
  display: inline-block;
`,yt=r.div`
  position: absolute;
  bottom: -1px;
  right: -3px;
  line-height: 0;
`,wt=r.div`
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-top: 2px;
  line-height: 1;
  gap: 4px;
`,jt=r.div`
  display: flex;
  align-items: baseline;
  gap: 4px;
  white-space: nowrap;
`,kt=r.span`
  font-family: var(--font-mono);
  font-size: 15px;
  color: #fff;
  font-weight: 700;

  @media (max-width: 480px) {
    font-size: 13px;
  }
`,$t=r.span`
  font-family: var(--font-mono);
  font-size: 11px;
  color: var(--grey-light);
  opacity: 0.7;
`,St=r.div`
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 2px;
  justify-content: center;
  max-width: 38px;
`,Mt=r.span`
  display: inline-block;
  width: 6px;
  height: 6px;
  border-radius: var(--radius-full);
  background: ${t=>t.$win?"var(--green)":"var(--red)"};
  opacity: 0.8;

  @media (max-width: 480px) {
    width: 5px;
    height: 5px;
  }
`,Ct=r(ge)`
  width: 14px;
  height: 14px;
  color: var(--red);
  fill: var(--red);
  margin-left: 6px;
  animation: pulse 1.5s infinite;
  flex-shrink: 0;
`,ue=r.span`
  font-family: var(--font-body);
  color: #e0e0e0;
  font-size: 15px;
  line-height: 1.6;
  word-break: break-word;

  @media (max-width: 480px) {
    font-size: 14px;
    line-height: 1.5;
  }
`,Tt=r.div`
  padding: 2px var(--space-4) 2px 84px;
  line-height: 1.375;
  font-size: 13px;
  color: var(--grey-light);
  font-style: italic;
  opacity: 0.7;
`,zt=r.button`
  position: absolute;
  bottom: var(--space-1);
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  align-items: center;
  gap: var(--space-2);
  background: linear-gradient(180deg, rgba(30, 24, 16, 0.95) 0%, rgba(15, 12, 8, 0.98) 100%);
  border: 1px solid rgba(252, 219, 51, 0.4);
  border-radius: var(--radius-md);
  color: var(--gold);
  font-family: var(--font-display);
  font-size: var(--text-xxs);
  letter-spacing: 0.5px;
  padding: var(--space-2) var(--space-4);
  cursor: pointer;
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.6), inset 0 1px 0 rgba(252, 219, 51, 0.1);
  transition: all 0.2s ease;

  &::after {
    content: "▼";
    font-size: 9px;
  }

  &:hover {
    border-color: var(--gold);
    background: linear-gradient(180deg, rgba(252, 219, 51, 0.12) 0%, rgba(252, 219, 51, 0.04) 100%);
    box-shadow: 0 2px 16px rgba(252, 219, 51, 0.15), inset 0 1px 0 rgba(252, 219, 51, 0.15);
  }
`,Dt=r.div`
  position: relative;
  flex: 1;
  overflow: hidden;
  display: flex;
  flex-direction: column;
`,ve=r.div`
  display: flex;
  align-items: center;
  gap: var(--space-4);
  margin: var(--space-6) 0 var(--space-2);
  padding: 0 var(--space-4);

  &:first-child {
    margin-top: var(--space-2);
  }

  &::before,
  &::after {
    content: "";
    flex: 1;
    height: 1px;
    background: rgba(160, 130, 80, 0.15);
  }
`,be=r.span`
  font-family: var(--font-mono);
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  color: var(--grey-light);
  white-space: nowrap;
`;r.form`
  display: flex;
  align-items: center;
  gap: var(--space-2);
  padding: var(--space-2) var(--space-4);
  background: rgba(10, 8, 6, 0.4);
  border-top: 1px solid rgba(252, 219, 51, 0.15);
  flex-shrink: 0;
`;r.input`
  flex: 1;
  min-width: 0;
  background: rgba(255, 255, 255, 0.06);
  border: 1px solid rgba(160, 130, 80, 0.2);
  border-radius: var(--radius-sm);
  padding: var(--space-2) var(--space-2);
  color: #e0e0e0;
  font-family: var(--font-body);
  font-size: 14px;
  outline: none;
  transition: border-color 0.15s;

  &:focus {
    border-color: rgba(252, 219, 51, 0.4);
  }

  &::placeholder {
    color: var(--grey-mid);
  }

  &:disabled {
    opacity: 0.5;
  }
`;r.button`
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  border: 1px solid rgba(160, 130, 80, 0.3);
  border-radius: var(--radius-sm);
  background: rgba(252, 219, 51, 0.08);
  color: var(--gold);
  cursor: pointer;
  flex-shrink: 0;
  transition: all 0.15s;

  &:hover:not(:disabled) {
    background: rgba(252, 219, 51, 0.15);
    border-color: var(--gold);
  }

  &:disabled {
    opacity: 0.3;
    cursor: default;
  }
`;r.button`
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  border: 1px solid rgba(160, 130, 80, 0.2);
  border-radius: var(--radius-sm);
  background: ${t=>t.$active?"rgba(252, 219, 51, 0.1)":"transparent"};
  color: ${t=>t.$active?"var(--gold)":"var(--grey-mid)"};
  cursor: pointer;
  flex-shrink: 0;
  transition: all 0.15s;

  &:hover {
    color: var(--gold);
    border-color: rgba(160, 130, 80, 0.4);
  }
`;r.div`
  display: flex;
  align-items: center;
  gap: var(--space-2);
  padding: var(--space-2) var(--space-4);
  background: rgba(10, 8, 6, 0.4);
  border-top: 1px solid rgba(252, 219, 51, 0.15);
  flex-shrink: 0;
`;r.input`
  flex: 1;
  min-width: 0;
  background: rgba(255, 255, 255, 0.06);
  border: 1px solid rgba(160, 130, 80, 0.2);
  border-radius: var(--radius-sm);
  padding: var(--space-2) var(--space-2);
  color: #e0e0e0;
  font-family: var(--font-mono);
  font-size: 12px;
  outline: none;

  &:focus {
    border-color: rgba(252, 219, 51, 0.4);
  }

  &::placeholder {
    color: var(--grey-mid);
  }
`;r.span`
  font-family: var(--font-mono);
  font-size: 11px;
  color: var(--grey-light);
  white-space: nowrap;
`;r.span`
  font-family: var(--font-mono);
  font-size: 11px;
  color: var(--red);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
`;const ye=r.div`
  margin: 2px 0 2px 84px;
  padding: 2px 10px;
  font-family: var(--font-mono);
  font-size: 13px;
  color: var(--grey-light);
  font-style: italic;
  opacity: 0.8;
  line-height: 1.4;

  @media (max-width: 480px) {
    margin-left: 66px;
  }
`,we=r.span`
  font-family: var(--font-mono);
  font-size: 10px;
  font-weight: 700;
  color: var(--grey-light);
  text-transform: uppercase;
  letter-spacing: 0.08em;
  margin-right: 6px;
  font-style: normal;
  opacity: 0.6;
`,ae=r.div`
  margin: 4px 0 4px 84px;
  padding: 6px 10px;
  border-left: 3px solid var(--gold);
  background: rgba(252, 219, 51, 0.04);
  border-radius: 0 var(--radius-sm) var(--radius-sm) 0;

  @media (max-width: 480px) {
    margin-left: 66px;
  }
`,ie=r.span`
  font-family: var(--font-mono);
  font-size: 10px;
  font-weight: 700;
  color: var(--gold);
  text-transform: uppercase;
  letter-spacing: 0.08em;
  margin-right: 6px;
`,W=r.span`
  font-family: var(--font-mono);
  font-size: 10px;
  color: var(--grey-light);
  opacity: 0.7;
`,se=r.pre`
  font-family: var(--font-mono);
  font-size: 13px;
  color: #ccc;
  margin: 2px 0 0;
  white-space: pre-wrap;
  word-break: break-word;
  line-height: 1.4;
`;r.form`
  display: flex;
  align-items: center;
  gap: var(--space-2);
  padding: var(--space-1) var(--space-4);
  background: rgba(252, 219, 51, 0.03);
  border-top: 1px solid rgba(252, 219, 51, 0.1);
  flex-shrink: 0;
`;r.span`
  font-family: var(--font-mono);
  font-size: 12px;
  font-weight: 700;
  color: var(--gold);
  opacity: 0.7;
`;r.input`
  flex: 1;
  min-width: 0;
  background: rgba(255, 255, 255, 0.04);
  border: 1px solid rgba(252, 219, 51, 0.15);
  border-radius: var(--radius-sm);
  padding: 5px var(--space-2);
  color: #e0e0e0;
  font-family: var(--font-mono);
  font-size: 13px;
  outline: none;
  transition: border-color 0.15s;

  &:focus {
    border-color: rgba(252, 219, 51, 0.4);
  }

  &::placeholder {
    color: var(--grey-mid);
    font-size: 11px;
  }

  &:disabled {
    opacity: 0.5;
  }
`;const Rt=r.div`
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: var(--font-mono);
  font-size: var(--text-xs);
  color: var(--grey-light);
  text-transform: uppercase;
  letter-spacing: 0.1em;
`;function je(t){const o=new Date(t),n=new Date;if(o.getDate()===n.getDate()&&o.getMonth()===n.getMonth()&&o.getFullYear()===n.getFullYear())return"Today";const c=new Date(n);return c.setDate(c.getDate()-1),o.getDate()===c.getDate()&&o.getMonth()===c.getMonth()&&o.getFullYear()===c.getFullYear()?"Yesterday":o.toLocaleDateString([],{month:"short",day:"numeric",year:"numeric"})}function ke(t){const o=new Date(t);return`${o.getFullYear()}-${o.getMonth()}-${o.getDate()}`}function It(t){return new Date(t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function Ft(t){const o=new Date(t),n=new Date,l=o.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"});if(o.getDate()===n.getDate()&&o.getMonth()===n.getMonth()&&o.getFullYear()===n.getFullYear())return l;const g=new Date(n);return g.setDate(g.getDate()-1),o.getDate()===g.getDate()&&o.getMonth()===g.getMonth()&&o.getFullYear()===g.getFullYear()?`Yesterday ${l}`:`${o.getMonth()+1}/${o.getDate()}/${String(o.getFullYear()).slice(2)} ${l}`}function At(t,o,n){var f;const l=(f=o==null?void 0:o.get(t))==null?void 0:f.profilePicUrl;if(l)return e.jsx(gt,{src:l,alt:""});const c=n==null?void 0:n.get(t),g=(c==null?void 0:c.race)!=null?J[c.race]:null;return g?e.jsx(me,{src:g,alt:""}):e.jsx(me,{src:Ie.random,alt:"",$faded:!0})}const Lt="https://4v4gg-chat-relay.fly.dev",$e="chat_admin_key";function Et({messages:t,status:o,avatars:n,stats:l,sessions:c,inGameTags:g,recentWinners:f,botResponses:b=[],translations:h=new Map,borderTheme:y,sendMessage:k}){const $=s.useRef(null),M=s.useRef(null),[S,I]=s.useState(!0),[O,U]=s.useState(!1),[L,Y]=s.useState(()=>localStorage.getItem($e)||""),[K,_]=s.useState(!1),[F,B]=s.useState(""),[w,A]=s.useState(!1),[j,d]=s.useState(null),[E,H]=s.useState(""),[T,X]=s.useState(!1);s.useCallback(async i=>{var a;if(i.preventDefault(),!(!F.trim()||!L||w||!k)){A(!0),d(null);try{await k(F.trim(),L),B(""),(a=M.current)==null||a.focus()}catch(p){d(p.message)}finally{A(!1)}}},[F,L,w,k]),s.useCallback(async i=>{i.preventDefault();const a=E.trim();if(!a||T)return;const p=a.startsWith("!")?a:`!${a}`;X(!0);try{const m=L||localStorage.getItem($e)||"",C=await fetch(`${Lt}/api/admin/bot/test`,{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":m},body:JSON.stringify({command:p})});if(!C.ok){const D=await C.json().catch(()=>({}));throw new Error(D.error||`Failed (${C.status})`)}H("")}catch(m){d(m.message)}finally{X(!1)}},[E,L,T]);const{botResponseMap:G,unmatchedBotResponses:V}=s.useMemo(()=>{const i=new Map,a=new Set;for(const m of b)for(let C=t.length-1;C>=0;C--){const D=t[C];if((D.battle_tag||D.battleTag)===m.triggeredByTag&&D.message.toLowerCase().startsWith(m.command)){i.set(D.id,m),a.add(m);break}}const p=b.filter(m=>!a.has(m));return{botResponseMap:i,unmatchedBotResponses:p}},[b,t]),u=s.useMemo(()=>{const i=[];for(let a=0;a<t.length;a++){const p=t[a],m=p.battle_tag||p.battleTag;let C=a===0;if(!C){const D=t[a-1];if((D.battle_tag||D.battleTag)!==m)C=!0;else{const z=new Date(D.sent_at||D.sentAt).getTime();new Date(p.sent_at||p.sentAt).getTime()-z>120*1e3&&(C=!0)}}C?i.push({start:p,continuations:[]}):i.length>0&&i[i.length-1].continuations.push(p)}return i},[t]);s.useEffect(()=>{S&&$.current?$.current.scrollTop=$.current.scrollHeight:!S&&t.length>0&&U(!0)},[t,S]);function v(){const i=$.current;if(!i)return;const a=i.scrollHeight-i.scrollTop-i.clientHeight<40;I(a),a&&U(!1)}function x(){$.current&&($.current.scrollTop=$.current.scrollHeight),I(!0),U(!1)}return e.jsxs(tt,{children:[e.jsxs(rt,{$theme:y,children:[e.jsxs(ot,{$theme:y,children:[e.jsx(nt,{children:"4v4 Chat"}),e.jsxs(at,{children:[e.jsx(it,{$connected:o==="connected"}),o==="connected"?t.length:"Connecting..."]})]}),t.length===0?e.jsx(Rt,{children:o==="connected"?"No messages yet":"Connecting to chat..."}):e.jsxs(Dt,{children:[e.jsxs(st,{ref:$,onScroll:v,children:[u.map((i,a)=>{var R,P,Z;const p=i.start,m=p.battle_tag||p.battleTag,C=p.user_name||p.userName,D=p.sent_at||p.sentAt,Q=ke(D);let z=a===0;if(!z&&a>0){const N=u[a-1].start,q=N.sent_at||N.sentAt;z=ke(q)!==Q}return!m||m==="system"?e.jsxs(ne.Fragment,{children:[z&&e.jsx(ve,{children:e.jsx(be,{children:je(D)})}),e.jsx(Tt,{children:p.message})]},p.id):e.jsxs(ne.Fragment,{children:[z&&e.jsx(ve,{children:e.jsx(be,{children:je(D)})}),e.jsxs(lt,{children:[e.jsxs(vt,{children:[e.jsxs(bt,{children:[At(m,n,l),((R=n==null?void 0:n.get(m))==null?void 0:R.country)&&e.jsx(yt,{children:e.jsx(Re,{name:n.get(m).country.toLowerCase()})})]}),(((P=l==null?void 0:l.get(m))==null?void 0:P.mmr)!=null||(c==null?void 0:c.get(m)))&&e.jsxs(wt,{children:[((Z=l==null?void 0:l.get(m))==null?void 0:Z.mmr)!=null&&e.jsxs(jt,{children:[e.jsx(kt,{children:Math.round(l.get(m).mmr)}),e.jsx($t,{children:"MMR"})]}),(c==null?void 0:c.get(m))&&e.jsx(St,{children:c.get(m).map((N,q)=>e.jsx(Mt,{$win:N},q))})]})]}),e.jsx(ct,{children:e.jsxs(ht,{children:[e.jsx("div",{children:e.jsxs(xt,{children:[e.jsx(ut,{to:`/player/${encodeURIComponent(m)}`,children:C}),(g==null?void 0:g.has(m))&&e.jsx(Ct,{}),(f==null?void 0:f.has(m))&&e.jsx(mt,{src:he,alt:""}),e.jsx(ft,{children:Ft(p.sent_at||p.sentAt)})]})}),e.jsx(ue,{children:p.message}),h.has(p.id)&&e.jsxs(ye,{style:{margin:"2px 0",padding:"2px 0"},children:[e.jsx(we,{children:"EN"}),h.get(p.id)]})]})}),G.has(p.id)&&e.jsxs(ae,{children:[e.jsx(ie,{children:"BOT"}),!G.get(p.id).botEnabled&&e.jsx(W,{children:"(preview)"}),e.jsx(se,{children:G.get(p.id).response})]}),i.continuations.map(N=>{const q=G.get(N.id);return e.jsxs(ne.Fragment,{children:[e.jsxs(dt,{children:[e.jsx(pt,{className:"hover-timestamp",children:It(N.sent_at||N.sentAt)}),e.jsx(ue,{children:N.message})]}),h.has(N.id)&&e.jsxs(ye,{children:[e.jsx(we,{children:"EN"}),h.get(N.id)]}),q&&e.jsxs(ae,{children:[e.jsx(ie,{children:"BOT"}),!q.botEnabled&&e.jsx(W,{children:"(preview)"}),e.jsx(se,{children:q.response})]})]},N.id)})]})]},p.id)}),V.map((i,a)=>e.jsxs(ae,{style:{marginLeft:"var(--space-4)"},children:[e.jsx(ie,{children:"BOT"}),!i.botEnabled&&e.jsx(W,{children:"(preview)"}),e.jsx(W,{style:{marginLeft:6},children:i.command}),e.jsx(se,{children:i.response})]},`bot-${a}`))]}),O&&e.jsx(zt,{onClick:x,children:"New messages below"})]})]}),!1,!1,!1]})}const Ut=r.aside`
  width: 460px;
  height: 100%;
  box-sizing: border-box;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  flex-shrink: 0;

  @media (max-width: 768px) {
    position: fixed;
    inset: 0;
    width: 100%;
    height: 100vh;
    z-index: 10001;
    transform: ${t=>t.$mobileVisible?"translateY(0)":"translateY(100%)"};
    transition: transform 0.25s ease;
  }
`,Bt=r.div`
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--space-4);
  border-bottom: 1px solid rgba(252, 219, 51, 0.15);
  flex-shrink: 0;
`,Yt=r.div`
  flex: 1;
  min-height: 0;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  box-sizing: border-box;
  background: ${t=>{var o;return((o=t.$theme)==null?void 0:o.bg)||"rgba(10, 8, 6, 0.25)"}};
  backdrop-filter: ${t=>{var o;return((o=t.$theme)==null?void 0:o.blur)||"blur(1px)"}};
  border: ${t=>{var o;return((o=t.$theme)==null?void 0:o.border)||"8px solid transparent"}};
  border-image: ${t=>{var o;return((o=t.$theme)==null?void 0:o.borderImage)||'url("/frames/chat/ChatFrameBorder.png") 30 / 8px stretch'}};
  box-shadow: ${t=>{var o;return((o=t.$theme)==null?void 0:o.shadow)||"none"}};
`,_t=r.span`
  font-family: var(--font-display);
  font-size: var(--text-sm);
  color: var(--gold);
  letter-spacing: 1px;
`,Nt=r.span`
  font-family: var(--font-mono);
  font-size: var(--text-xxs);
  color: var(--grey-light);
`,Ot=r.button`
  background: none;
  border: 1px solid rgba(160, 130, 80, 0.2);
  border-radius: var(--radius-sm);
  color: var(--grey-light);
  font-family: var(--font-mono);
  font-size: 11px;
  letter-spacing: 0.5px;
  text-transform: uppercase;
  padding: 3px 8px;
  cursor: pointer;
  transition: all 0.15s;

  &:hover {
    color: var(--gold);
    border-color: rgba(160, 130, 80, 0.4);
  }
`,Ht=r.button`
  display: none;
  background: none;
  border: none;
  color: var(--grey-light);
  font-size: 22px;
  line-height: 1;
  cursor: pointer;
  padding: 4px;

  &:hover {
    color: #fff;
  }

  @media (max-width: 768px) {
    display: block;
  }
`,Pt=r.div`
  flex: 1;
  overflow-y: auto;
  padding: var(--space-1) var(--space-4);

  &::-webkit-scrollbar {
    width: 6px;
  }
  &::-webkit-scrollbar-track {
    background: transparent;
  }
  &::-webkit-scrollbar-thumb {
    background: var(--grey-mid);
    border-radius: 3px;
  }
`,Kt=r.div`
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: var(--font-mono);
  font-size: var(--text-xxs);
  color: var(--grey-light);
  text-transform: uppercase;
  letter-spacing: 0.1em;
  padding: var(--space-4);
`,Vt=r(oe)`
  display: block;
  text-decoration: none;
  color: inherit;
  margin: var(--space-4) 0;
  border-radius: var(--radius-md);
  border: 1px solid rgba(160, 130, 80, 0.12);
  overflow: hidden;
  transition: all 0.15s;

  &:hover {
    border-color: rgba(160, 130, 80, 0.25);
  }
`,Le=r.div`
  display: flex;
  align-items: center;
  gap: var(--space-4);
  padding: var(--space-4) var(--space-6) var(--space-2);
  background: rgba(255, 255, 255, 0.02);
`,Ee=r.img`
  width: 72px;
  height: 72px;
  border-radius: var(--radius-sm);
  object-fit: cover;
  flex-shrink: 0;
`,Ue=r.div`
  flex: 1;
  min-width: 0;
`,Be=r.div`
  font-family: var(--font-display);
  font-size: var(--text-lg);
  color: #fff;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
`,Ye=r.div`
  display: flex;
  align-items: baseline;
  gap: 5px;
  margin-top: 4px;
`,_e=r.span`
  font-family: var(--font-mono);
  font-size: 18px;
  color: #fff;
  font-weight: 700;
`,Ne=r.span`
  font-family: var(--font-mono);
  font-size: 12px;
  color: var(--grey-light);
  opacity: 0.7;
`,Oe=r.div`
  width: 80px;
  flex-shrink: 0;
  align-self: stretch;
  padding: var(--space-2) 0;
  box-sizing: border-box;
`,He=r.div`
  font-family: var(--font-mono);
  font-size: 14px;
  color: var(--grey-light);
  margin-top: 3px;
`,Gt=r.span`
  display: inline-block;
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: var(--red);
  margin-right: 4px;
  animation: pulse 1.5s infinite;
`,Pe=r.div`
  display: flex;
  align-items: center;
  padding: var(--space-2) var(--space-6) var(--space-3);
  gap: 0;
`,Se=r.div`
  flex: 1;
  min-width: 0;
`,ee=r.div`
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 8px;
  flex-direction: ${t=>t.$reverse?"row-reverse":"row"};

  &:last-child {
    margin-bottom: 0;
  }
`,te=r.img`
  width: 22px;
  height: 22px;
  flex-shrink: 0;
`,re=r.span`
  font-family: var(--font-display);
  font-size: var(--text-sm);
  color: var(--gold);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  min-width: 0;
  flex: 1;
  text-align: ${t=>t.$right?"right":"left"};
  cursor: pointer;

  &:hover {
    text-decoration: underline;
  }
`,Xt=Fe`
  0% { opacity: 1; }
  75% { opacity: 1; }
  100% { opacity: 0; }
`,qt=Fe`
  0% { top: 50%; left: 50%; transform: translate(-50%, -50%); width: 80px; height: 80px; opacity: 0; }
  20% { top: 50%; left: 50%; transform: translate(-50%, -50%); width: 80px; height: 80px; opacity: 1; }
  50% { top: 50%; left: 50%; transform: translate(-50%, -50%); width: 80px; height: 80px; opacity: 1; }
  100% { top: 55%; left: var(--crown-end-x); transform: translate(-50%, -50%); width: 28px; height: 28px; opacity: 1; }
`,Jt=r(oe)`
  display: block;
  text-decoration: none;
  color: inherit;
  position: relative;
  margin: var(--space-4) 0;
  border-radius: var(--radius-md);
  border: 1px solid var(--gold);
  overflow: hidden;
  animation: ${Xt} 8s ease forwards;
`,Qt=r.img`
  position: absolute;
  z-index: 3;
  pointer-events: none;
  filter: drop-shadow(0 0 12px rgba(252, 219, 51, 0.6)) drop-shadow(0 2px 4px rgba(0, 0, 0, 0.8));
  animation: ${qt} 2s ease-out forwards;
`,Zt=r.div`
  position: absolute;
  inset: 0;
  z-index: 2;
  pointer-events: none;
  background: rgba(0, 0, 0, 0.5);
  animation: backdropFade 2s ease-out forwards;

  @keyframes backdropFade {
    0% { opacity: 0; }
    20% { opacity: 1; }
    50% { opacity: 1; }
    100% { opacity: 0; }
  }
`,Me=r.div`
  flex: 1;
  min-width: 0;
`,Ce=r.div`
  flex: 1;
  min-width: 0;
  opacity: 0.35;
`;function Te(t){var l;const n=(t.teams||((l=t.match)==null?void 0:l.teams)||[]).flatMap(c=>{var g;return((g=c.players)==null?void 0:g.map(f=>f.oldMmr||0))||[]});return n.length>0?n.reduce((c,g)=>c+g,0)/n.length:0}function Wt({startTime:t}){const[o,n]=s.useState(()=>xe(t));return s.useEffect(()=>{const l=setInterval(()=>{n(xe(t))},1e3);return()=>clearInterval(l)},[t]),e.jsxs(He,{children:[e.jsx(Gt,{}),o]})}function er({match:t}){var O,U,L,Y,K,_,F,B;const o=Ve(),n=t.mapName||((O=t.match)==null?void 0:O.mapName),l=(n==null?void 0:n.replace(/^\(\d\)\s*/,""))||"Unknown",c=Ae(n),g=t.teams||((U=t.match)==null?void 0:U.teams)||[],f=t.startTime||((L=t.match)==null?void 0:L.startTime),b=g[0],h=g[1],y=((Y=b==null?void 0:b.players)==null?void 0:Y.map(w=>w.oldMmr||0))||[],k=((K=h==null?void 0:h.players)==null?void 0:K.map(w=>w.oldMmr||0))||[],$=[...y,...k],M=$.length>0?Math.round($.reduce((w,A)=>w+A,0)/$.length):null,S={teamOneMmrs:y,teamTwoMmrs:k},I=t.id||((_=t.match)==null?void 0:_.id);return e.jsxs(Vt,{to:I?`/match/${I}`:"/",children:[e.jsxs(Le,{children:[c&&e.jsx(Ee,{src:c,alt:""}),e.jsxs(Ue,{children:[e.jsx(Be,{children:l}),M!=null&&e.jsxs(Ye,{children:[e.jsx(_e,{children:M}),e.jsx(Ne,{children:"MMR"})]}),f&&e.jsx(Wt,{startTime:f})]})]}),e.jsxs(Pe,{children:[e.jsx(Se,{$team:1,children:(F=b==null?void 0:b.players)==null?void 0:F.map((w,A)=>e.jsxs(ee,{children:[e.jsx(te,{src:J[w.race],alt:""}),e.jsx(re,{onClick:j=>{j.preventDefault(),j.stopPropagation(),o.push(`/player/${encodeURIComponent(w.battleTag)}`)},children:w.name})]},A))}),e.jsx(Oe,{children:e.jsx(We,{data:S,compact:!0,hideLabels:!0,showMean:!1,showStdDev:!1})}),e.jsx(Se,{$team:2,children:(B=h==null?void 0:h.players)==null?void 0:B.map((w,A)=>e.jsxs(ee,{$reverse:!0,children:[e.jsx(te,{src:J[w.race],alt:""}),e.jsx(re,{$right:!0,onClick:j=>{j.preventDefault(),j.stopPropagation(),o.push(`/player/${encodeURIComponent(w.battleTag)}`)},children:w.name})]},A))})]})]})}function tr({match:t}){var Y,K,_,F,B,w,A;const o=t.mapName||((Y=t.match)==null?void 0:Y.mapName),n=(o==null?void 0:o.replace(/^\(\d\)\s*/,""))||"Unknown",l=Ae(o),c=t.teams||((K=t.match)==null?void 0:K.teams)||[],g=t._winnerTeam,f=t.durationInSeconds,b=f?`${Math.floor(f/60)}:${String(f%60).padStart(2,"0")}`:null,h=c[0],y=c[1],k=((_=h==null?void 0:h.players)==null?void 0:_.map(j=>j.oldMmr||0))||[],$=((F=y==null?void 0:y.players)==null?void 0:F.map(j=>j.oldMmr||0))||[],M=[...k,...$],S=M.length>0?Math.round(M.reduce((j,d)=>j+d,0)/M.length):null,I=t.id||((B=t.match)==null?void 0:B.id),O=g===0?Me:Ce,U=g===1?Me:Ce,L=g===0?"25%":"75%";return e.jsxs(Jt,{to:I?`/match/${I}`:"/",style:{"--crown-end-x":L},children:[e.jsx(Zt,{}),g!=null&&e.jsx(Qt,{src:he,alt:""}),e.jsxs(Le,{children:[l&&e.jsx(Ee,{src:l,alt:""}),e.jsxs(Ue,{children:[e.jsx(Be,{children:n}),S!=null&&e.jsxs(Ye,{children:[e.jsx(_e,{children:S}),e.jsx(Ne,{children:"MMR"})]}),b&&e.jsx(He,{children:b})]})]}),e.jsxs(Pe,{children:[e.jsx(O,{children:(w=h==null?void 0:h.players)==null?void 0:w.map((j,d)=>e.jsxs(ee,{children:[e.jsx(te,{src:J[j.race],alt:""}),e.jsx(re,{children:j.name})]},d))}),e.jsx(Oe,{}),e.jsx(U,{children:(A=y==null?void 0:y.players)==null?void 0:A.map((j,d)=>e.jsxs(ee,{$reverse:!0,children:[e.jsx(te,{src:J[j.race],alt:""}),e.jsx(re,{$right:!0,children:j.name})]},d))})]})]})}function rr({matches:t=[],finishedMatches:o=[],$mobileVisible:n,onClose:l,borderTheme:c}){const[g,f]=s.useState("mmr"),b=s.useMemo(()=>{const h=[...t];return g==="mmr"?h.sort((y,k)=>Te(k)-Te(y)):h.sort((y,k)=>{var S,I;const $=new Date(y.startTime||((S=y.match)==null?void 0:S.startTime)||0).getTime();return new Date(k.startTime||((I=k.match)==null?void 0:I.startTime)||0).getTime()-$}),h},[t,g]);return e.jsx(Ut,{$mobileVisible:n,children:e.jsxs(Yt,{$theme:c,children:[e.jsxs(Bt,{$theme:c,children:[e.jsx(_t,{children:"Active Games"}),e.jsx(Nt,{children:t.length}),e.jsx(Ot,{onClick:()=>f(h=>h==="mmr"?"recent":"mmr"),children:g==="mmr"?"MMR":"Recent"}),e.jsx(Ht,{onClick:l,children:"×"})]}),b.length===0&&o.length===0?e.jsx(Kt,{children:"No active games"}):e.jsxs(Pt,{children:[o.map(h=>e.jsx(tr,{match:h},`fin-${h.id}`)),b.map(h=>{var y;return e.jsx(er,{match:h},h.id||((y=h.match)==null?void 0:y.id))})]})]})})}const or=r.aside`
  width: 268px;
  height: 100%;
  box-sizing: border-box;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  flex-shrink: 0;

  @media (max-width: 768px) {
    position: fixed;
    inset: 0;
    width: 100%;
    height: 100vh;
    z-index: 10001;
    transform: ${t=>t.$mobileVisible?"translateY(0)":"translateY(100%)"};
    transition: transform 0.25s ease;
  }
`,nr=r.div`
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--space-4);
  border-bottom: 1px solid rgba(252, 219, 51, 0.15);
  flex-shrink: 0;
`,ar=r.div`
  flex: 1;
  min-height: 0;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  box-sizing: border-box;
  background: ${t=>{var o;return((o=t.$theme)==null?void 0:o.bg)||"rgba(10, 8, 6, 0.25)"}};
  backdrop-filter: ${t=>{var o;return((o=t.$theme)==null?void 0:o.blur)||"blur(1px)"}};
  border: ${t=>{var o;return((o=t.$theme)==null?void 0:o.border)||"8px solid transparent"}};
  border-image: ${t=>{var o;return((o=t.$theme)==null?void 0:o.borderImage)||'url("/frames/chat/ChatFrameBorder.png") 30 / 8px stretch'}};
  box-shadow: ${t=>{var o;return((o=t.$theme)==null?void 0:o.shadow)||"none"}};
`,ir=r.span`
  font-family: var(--font-display);
  font-size: var(--text-sm);
  color: var(--gold);
  letter-spacing: 1px;
`,sr=r.span`
  font-family: var(--font-mono);
  font-size: var(--text-xxs);
  color: var(--grey-light);
`,lr=r.button`
  display: none;
  background: none;
  border: none;
  color: var(--grey-light);
  font-size: 22px;
  line-height: 1;
  cursor: pointer;
  padding: 4px;

  &:hover {
    color: #fff;
  }

  @media (max-width: 768px) {
    display: block;
  }
`,cr=r.div`
  position: relative;
  margin: 12px var(--space-4);

  &::before {
    content: "⌕";
    position: absolute;
    left: 10px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--grey-light);
    font-size: 15px;
    pointer-events: none;
  }
`,dr=r.input`
  width: 100%;
  padding: 10px 32px 10px 30px;
  font-family: var(--font-display);
  font-size: var(--text-xs);
  letter-spacing: 0.3px;
  color: #fff;
  background: linear-gradient(180deg, rgba(25, 20, 15, 0.9) 0%, rgba(12, 10, 8, 0.95) 100%);
  border: 1px solid rgba(160, 130, 80, 0.25);
  border-radius: var(--radius-md);
  outline: none;
  box-sizing: border-box;
  transition: all 0.2s ease;

  &::placeholder {
    color: var(--grey-light);
    font-size: var(--text-xxs);
  }

  &:focus {
    border-color: var(--gold);
    box-shadow: 0 0 8px rgba(252, 219, 51, 0.15);
  }
`,pr=r.button`
  position: absolute;
  right: 8px;
  top: 50%;
  transform: translateY(-50%);
  background: none;
  border: none;
  color: var(--grey-light);
  font-size: 18px;
  cursor: pointer;
  padding: 0 4px;
  line-height: 1;

  &:hover {
    color: #fff;
  }
`,gr=r.div`
  display: flex;
  align-items: center;
  padding: var(--space-2) var(--space-4);
  padding-left: calc(var(--space-4) + 28px + var(--space-2));
  border-bottom: 1px solid rgba(160, 130, 80, 0.2);
  background: rgba(20, 16, 12, 0.6);
  font-family: var(--font-mono);
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  color: var(--grey-light);
`,Ke=r.span`
  cursor: pointer;
  user-select: none;
  transition: color 0.15s;
  color: ${t=>t.$active?"var(--gold)":"var(--grey-light)"};

  &:hover {
    color: var(--gold);
  }
`,hr=r(Ke)`
  flex: 1;
`,fr=r(Ke)`
  flex-shrink: 0;
`,xr=r.div`
  flex: 1;
  overflow-y: auto;
  padding: var(--space-1) 0;

  &::-webkit-scrollbar {
    width: 6px;
  }
  &::-webkit-scrollbar-track {
    background: transparent;
  }
  &::-webkit-scrollbar-thumb {
    background: var(--grey-mid);
    border-radius: 3px;
  }
`,mr=r.div`
  display: flex;
  align-items: center;
  gap: var(--space-2);
  padding: var(--space-1) var(--space-4);
  cursor: default;
  border-radius: var(--radius-sm);

  &:hover {
    background: rgba(255, 255, 255, 0.04);
  }
`,ur=r(oe)`
  display: flex;
  align-items: center;
  gap: var(--space-2);
  padding: var(--space-1) var(--space-4);
  cursor: pointer;
  text-decoration: none;
  color: inherit;
  border-radius: var(--radius-sm);

  &:hover {
    background: rgba(255, 255, 255, 0.04);
  }
`,vr=r.div`
  position: relative;
  display: inline-block;
  flex-shrink: 0;
`,br=r.div`
  position: absolute;
  bottom: -2px;
  right: -2px;
  line-height: 0;
`,yr=r.img`
  width: 28px;
  height: 28px;
  border-radius: var(--radius-sm);
`,ze=r.img`
  width: 28px;
  height: 28px;
  border-radius: var(--radius-sm);
  padding: 4px;
  background: rgba(255, 255, 255, 0.06);
  opacity: ${t=>t.$faded?.2:.85};
`,wr=r(ge)`
  width: 12px;
  height: 12px;
  color: var(--red);
  fill: var(--red);
  flex-shrink: 0;
  animation: pulse 1.5s infinite;
`,jr=r.img.attrs({src:he,alt:""})`
  width: 14px;
  height: 14px;
  flex-shrink: 0;
  filter: drop-shadow(0 0 3px rgba(252, 219, 51, 0.4));
`,kr=r.img`
  width: 18px;
  height: 18px;
  flex-shrink: 0;
  opacity: 0.85;
`,$r=r.span`
  font-family: var(--font-display);
  font-size: var(--text-sm);
  color: var(--gold);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  min-width: 0;
  flex: 1;
`,Sr=r.span`
  font-family: var(--font-mono);
  font-size: var(--text-xxs);
  color: #fff;
  flex-shrink: 0;
`,le=r.div`
  padding: 12px var(--space-4) var(--space-2);
  margin-top: var(--space-1);
  font-family: var(--font-mono);
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  color: var(--grey-light);
  display: flex;
  align-items: center;
  gap: var(--space-2);
  cursor: pointer;
  user-select: none;
  transition: color 0.15s;
  border-top: 1px solid rgba(160, 130, 80, 0.12);

  &:first-child {
    border-top: none;
    margin-top: 0;
  }

  &:hover {
    color: #fff;
  }
`,ce=r.span`
  color: var(--gold);
`,de=r.span`
  font-size: 8px;
  transition: transform 0.2s;
  transform: ${t=>t.$open?"rotate(90deg)":"rotate(0deg)"};
`;function Mr(t,o,n){var f;const l=(f=o==null?void 0:o.get(t))==null?void 0:f.profilePicUrl;if(l)return e.jsx(yr,{src:l,alt:""});const c=n==null?void 0:n.get(t),g=(c==null?void 0:c.race)!=null?J[c.race]:null;return g?e.jsx(ze,{src:g,alt:""}):e.jsx(ze,{src:Ie.random,alt:"",$faded:!0})}const Cr=r.div`
  opacity: 0.4;
`;function pe({user:t,avatars:o,stats:n,inGame:l,matchUrl:c,isRecentWinner:g,isIdle:f}){var S;const b=n==null?void 0:n.get(t.battleTag),h=b==null?void 0:b.mmr,y=(b==null?void 0:b.race)!=null?J[b.race]:null,k=(S=o==null?void 0:o.get(t.battleTag))==null?void 0:S.country,$=e.jsxs(e.Fragment,{children:[e.jsxs(vr,{children:[Mr(t.battleTag,o,n),k&&e.jsx(br,{children:e.jsx(Re,{name:k.toLowerCase(),style:{width:14,height:10}})})]}),l&&e.jsx(wr,{}),g&&e.jsx(jr,{}),y&&e.jsx(kr,{src:y,alt:""}),e.jsx($r,{children:t.name}),h!=null&&e.jsx(Sr,{children:Math.round(h)})]});if(c)return e.jsx(ur,{to:c,children:$});const M=e.jsx(mr,{children:$});return f?e.jsx(Cr,{children:M}):M}function Tr({users:t,avatars:o,stats:n,inGameTags:l,idleTags:c,inGameMatchMap:g,recentWinners:f,$mobileVisible:b,onClose:h,borderTheme:y}){const[k,$]=s.useState(""),[M,S]=s.useState("mmr"),[I,O]=s.useState(!0),[U,L]=s.useState(!0),[Y,K]=s.useState(!0);function _(d){S(d)}const F=s.useMemo(()=>[...t].sort((d,E)=>{var X,G;if(M==="live"){const V=l!=null&&l.has(d.battleTag)?1:0,u=l!=null&&l.has(E.battleTag)?1:0;if(V!==u)return u-V}if(M==="name"){const V=(d.name||"").localeCompare(E.name||"",void 0,{sensitivity:"base"});if(V!==0)return V}const H=((X=n==null?void 0:n.get(d.battleTag))==null?void 0:X.mmr)??-1,T=((G=n==null?void 0:n.get(E.battleTag))==null?void 0:G.mmr)??-1;return H!==T?T-H:(d.name||"").localeCompare(E.name||"",void 0,{sensitivity:"base"})}),[t,n,l,M]),B=s.useMemo(()=>{if(!k.trim())return F;const d=k.toLowerCase();return F.filter(E=>(E.name||"").toLowerCase().includes(d))},[F,k]),{inGameUsers:w,onlineUsers:A,awayUsers:j}=s.useMemo(()=>{const d=[],E=[],H=[];for(const T of B)l!=null&&l.has(T.battleTag)?d.push(T):c!=null&&c.has(T.battleTag)?H.push(T):E.push(T);return{inGameUsers:d,onlineUsers:E,awayUsers:H}},[B,l,c]);return e.jsx(or,{$mobileVisible:b,children:e.jsxs(ar,{$theme:y,children:[e.jsxs(nr,{$theme:y,children:[e.jsx(ir,{children:"Channel"}),e.jsx(sr,{children:t.length}),e.jsx(lr,{onClick:h,children:"×"})]}),e.jsxs(cr,{children:[e.jsx(dr,{type:"text",placeholder:"Search players...",value:k,onChange:d=>$(d.target.value)}),k&&e.jsx(pr,{onClick:()=>$(""),children:"×"})]}),e.jsxs(gr,{children:[e.jsx(hr,{$active:M==="name",onClick:()=>_("name"),children:"Player"}),e.jsx(fr,{$active:M==="mmr",onClick:()=>_("mmr"),children:"MMR"})]}),e.jsxs(xr,{children:[w.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(le,{onClick:()=>O(d=>!d),children:[e.jsx(de,{$open:I,children:"▶"}),"In Game — ",e.jsx(ce,{children:w.length})]}),I&&w.map(d=>e.jsx(pe,{user:d,avatars:o,stats:n,inGame:!0,matchUrl:g==null?void 0:g.get(d.battleTag),isRecentWinner:f==null?void 0:f.has(d.battleTag)},d.battleTag))]}),e.jsxs(le,{onClick:()=>L(d=>!d),children:[e.jsx(de,{$open:U,children:"▶"}),"Online — ",e.jsx(ce,{children:A.length})]}),U&&A.map(d=>e.jsx(pe,{user:d,avatars:o,stats:n,inGame:!1,matchUrl:null,isRecentWinner:f==null?void 0:f.has(d.battleTag)},d.battleTag)),j.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(le,{onClick:()=>K(d=>!d),children:[e.jsx(de,{$open:Y,children:"▶"}),"Away — ",e.jsx(ce,{children:j.length})]}),Y&&j.map(d=>e.jsx(pe,{user:d,avatars:o,stats:n,inGame:!1,matchUrl:null,isRecentWinner:f==null?void 0:f.has(d.battleTag),isIdle:!0},d.battleTag))]})]})]})})}const zr=10800*1e3,Dr=r.div`
  padding: var(--space-1) var(--space-2) 0;
  position: relative;

  @media (max-width: 768px) {
    padding: 0;
  }
`,Rr=r.div`
  display: flex;
  gap: var(--space-2);
  height: calc(100vh - 52px);

  @media (max-width: 768px) {
    gap: 0;
    height: calc(100vh - 46px);
  }
`,De=r.button`
  display: none;
  position: fixed;
  bottom: var(--space-4);
  z-index: calc(var(--z-overlay) - 1);
  width: 48px;
  height: 48px;
  border-radius: var(--radius-full);
  border: 1px solid var(--gold);
  background: var(--grey-dark);
  color: var(--gold);
  font-size: 20px;
  cursor: pointer;
  align-items: center;
  justify-content: center;
  right: ${t=>t.$right||"auto"};
  left: ${t=>t.$left||"auto"};

  @media (max-width: 768px) {
    display: flex;
  }
`,Ur=()=>{const{messages:t,status:o,onlineUsers:n,botResponses:l,translations:c,sendMessage:g}=Ge(),{borderTheme:f}=Xe(),[b,h]=s.useState(new Map),[y,k]=s.useState(new Map),[$,M]=s.useState(new Map),[S,I]=s.useState([]),[O,U]=s.useState(!1),[L,Y]=s.useState(!1),[K,_]=s.useState([]),[F,B]=s.useState(new Set),[w,A]=s.useState(0),j=s.useRef(new Set),d=s.useRef(new Set),E=s.useRef(new Set),H=s.useCallback(async()=>{try{const u=await qe();I(u.matches||[])}catch{}},[]);s.useEffect(()=>{H();const u=setInterval(H,3e4);return()=>clearInterval(u)},[H]),s.useEffect(()=>{const u=setInterval(()=>A(v=>v+1),6e4);return()=>clearInterval(u)},[]),s.useEffect(()=>{const u=new Set(S.map(a=>{var p;return a.id||((p=a.match)==null?void 0:p.id)})),x=[...E.current].filter(a=>a&&!u.has(a));if(E.current=u,x.length===0)return;console.log("[GameEnd] Detected ended matches:",x);async function i(a,p=0){var D,Q;console.log(`[GameEnd] Fetching result for ${a}, attempt ${p}`);let m;try{const z=await fetch(`https://website-backend.w3champions.com/api/matches/${encodeURIComponent(a)}`);if(!z.ok)return;const R=await z.json();m=R==null?void 0:R.match}catch{return}if(!m)return;const C=(D=m.teams)==null?void 0:D.findIndex(z=>{var R;return(R=z.players)==null?void 0:R.some(P=>P.won===!0||P.won===1)});if(C<0&&p<3){setTimeout(()=>i(a,p+1),5e3);return}if(C>=0){const z=((Q=m.teams[C].players)==null?void 0:Q.map(R=>R.battleTag).filter(Boolean))||[];z.length>0&&(B(R=>{const P=new Set(R);return z.forEach(Z=>P.add(Z)),P}),setTimeout(()=>{B(R=>{const P=new Set(R);return z.forEach(Z=>P.delete(Z)),P})},12e4))}_(z=>[...z,{...m,id:a,_winnerTeam:C>=0?C:null,_finishedAt:Date.now()}]),setTimeout(()=>{_(z=>z.filter(R=>R.id!==a))},8e3)}for(const a of x)setTimeout(()=>i(a),5e3)},[S]);const T=s.useMemo(()=>{const u=new Set;for(const x of S)for(const i of x.teams)for(const a of i.players)a.battleTag&&u.add(a.battleTag);const v=Date.now();for(let x=t.length-1;x>=0;x--){const i=t[x],a=new Date(i.sent_at||i.sentAt).getTime();if(v-a>6e4)break;const p=i.battle_tag||i.battleTag;p&&u.delete(p)}return u},[S,t]),X=s.useMemo(()=>{const u=Date.now(),v=new Set;for(const x of n)x.joinedAt&&u-x.joinedAt>zr&&!T.has(x.battleTag)&&v.add(x.battleTag);return v},[n,T,w]),G=s.useMemo(()=>{const u=new Map;for(const v of S)for(const x of v.teams)for(const i of x.players)i.battleTag&&u.set(i.battleTag,`/player/${encodeURIComponent(i.battleTag)}`);return u},[S]);s.useEffect(()=>{const v=[...d.current].filter(x=>!T.has(x));d.current=new Set(T);for(const x of v)fe(x).then(i=>{var a;(a=i==null?void 0:i.session)!=null&&a.form&&M(p=>{const m=new Map(p);return m.set(x,i.session.form),m})})},[T]);const V=s.useMemo(()=>{const u=new Set;for(const v of t){const x=v.battle_tag||v.battleTag;x&&u.add(x)}for(const v of n)v.battleTag&&u.add(v.battleTag);return u},[t,n]);return s.useEffect(()=>{const u=[];for(const v of V)j.current.has(v)||(j.current.add(v),u.push(v));if(u.length!==0)for(const v of u)Je(v).then(x=>{h(i=>{const a=new Map(i);return a.set(v,x),a})}),Qe(v).then(x=>{x&&k(i=>{const a=new Map(i);return a.set(v,x),a})}),fe(v).then(x=>{var i;(i=x==null?void 0:x.session)!=null&&i.form&&M(a=>{const p=new Map(a);return p.set(v,x.session.form),p})})},[V]),e.jsxs(Dr,{children:[e.jsxs(Rr,{children:[e.jsx(rr,{matches:S,finishedMatches:K,$mobileVisible:L,onClose:()=>Y(!1),borderTheme:f}),e.jsx(Et,{messages:t,status:o,avatars:b,stats:y,sessions:$,inGameTags:T,recentWinners:F,botResponses:l,translations:c,borderTheme:f,sendMessage:g}),e.jsx(Tr,{users:n,avatars:b,stats:y,inGameTags:T,idleTags:X,inGameMatchMap:G,recentWinners:F,$mobileVisible:O,onClose:()=>U(!1),borderTheme:f})]}),!L&&!O&&e.jsxs(e.Fragment,{children:[e.jsx(De,{$left:"var(--space-4)",onClick:()=>Y(!0),children:e.jsx(ge,{})}),e.jsx(De,{$right:"var(--space-4)",onClick:()=>U(!0),children:e.jsx(et,{})})]})]})};export{Ur as default};
