import{r as x,R as k,j as r,k as G}from"./index-B9PX3LSb.js";import{M as F}from"./MmrComparison-BnTqQ874.js";const B=({matchData:m,atGroups:i={},sessionData:u={},mmrDuration:g=8e3,sessionDuration:j=4e3,streamerTag:L="",matchStyle:p="default"})=>{var N,C;const[h,S]=x.useState(!1),[b,w]=x.useState(!1);if(x.useEffect(()=>{if(!(Object.keys(u).length>0))return;let s;return(()=>{s=setTimeout(()=>{w(!0),setTimeout(()=>{S(a=>!a),w(!1)},800)},h?j:g)})(),()=>clearTimeout(s)},[h,u,g,j]),!(m!=null&&m.teams)||m.teams.length<2)return null;const d=L.toLowerCase(),f=((N=m.teams[0])==null?void 0:N.players)||[],M=((C=m.teams[1])==null?void 0:C.players)||[],O=f.some(e=>{var s,t;return((s=e.battleTag)==null?void 0:s.toLowerCase())===d||((t=e.name)==null?void 0:t.toLowerCase())===d.split("#")[0]}),y=M.some(e=>{var s,t;return((s=e.battleTag)==null?void 0:s.toLowerCase())===d||((t=e.name)==null?void 0:t.toLowerCase())===d.split("#")[0]}),[A,E]=y&&!O?[M,f]:[f,M],n=[...A].sort((e,s)=>(e.currentMmr||e.oldMmr||0)-(s.currentMmr||s.oldMmr||0)),o=[...E].sort((e,s)=>(s.currentMmr||s.oldMmr||0)-(e.currentMmr||e.oldMmr||0));if(n.length===0||o.length===0)return null;Math.round(n.reduce((e,s)=>e+(s.currentMmr||s.oldMmr||0),0)/n.length),Math.round(o.reduce((e,s)=>e+(s.currentMmr||s.oldMmr||0),0)/o.length);const P=e=>{for(const s of Object.values(i))if(s.includes(e))return!0;return!1},T=k.useMemo(()=>{const e={};let s=1;return Object.values(i).forEach(t=>{if(!Array.isArray(t)||t.length===0)return;const c=t.find(a=>e[a.toLowerCase()]);if(c){const a=e[c.toLowerCase()];t.forEach(l=>{e[l.toLowerCase()]=a})}else{const a=s++;t.forEach(l=>{e[l.toLowerCase()]=a})}}),t=>e[t==null?void 0:t.toLowerCase()]||0},[i]),R=(e,s)=>{for(const t of Object.values(i))if(t.includes(e.battleTag)&&t.includes(s.battleTag))return!0;return!1},$=e=>{const s=u[e];if(!(s!=null&&s.recentGames)||s.recentGames.length===0)return r.jsx("span",{className:"mo-mmr",children:"—"});const t=s.recentGames.slice(0,10);return r.jsx("div",{className:"mo-session-dots",children:t.map((c,a)=>r.jsx("span",{className:`mo-dot ${c?"win":"loss"} ${a===t.length-1?"latest":""}`},a))})},v=(e,s,t,c)=>{const a=t[s+1],l=a&&R(e,a),I=e.currentMmr||e.oldMmr||0;return r.jsxs("div",{className:"mo-player",children:[r.jsx("img",{src:G[e.race],alt:"",className:"mo-race"}),r.jsx("span",{className:`mo-name ${P(e.battleTag)?"is-at":""}`,children:e.name}),r.jsx("div",{className:`mo-stat ${b?"fading":""}`,children:h?$(e.battleTag):r.jsx("span",{className:"mo-mmr",children:I||"—"})}),l&&r.jsx("div",{className:"mo-at-line"})]},e.battleTag)};return r.jsx("div",{className:`minimal-overlay match-style-${p}`,children:r.jsxs("div",{className:"mo-players-row",children:[r.jsx("div",{className:"mo-team mo-team-1 team-blue",children:n.map((e,s)=>v(e,s,n))}),r.jsxs("div",{className:"mo-chart",children:[r.jsx(F,{data:{teamOneMmrs:n.map(e=>e.currentMmr||e.oldMmr||0),teamTwoMmrs:o.map(e=>e.currentMmr||e.oldMmr||0),teamOneAT:n.map(e=>T(e.battleTag)),teamTwoAT:o.map(e=>T(e.battleTag))},compact:!0,atStyle:"combined",showMean:!1,showStdDev:!0,hideLabels:!0}),r.jsx("span",{className:"mo-vs",children:"vs"})]}),r.jsx("div",{className:"mo-team mo-team-2 team-red",children:o.map((e,s)=>v(e,s,o))})]})})};export{B as M};
