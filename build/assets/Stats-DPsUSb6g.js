import{a as u,b as R,j as s,f as k,g as as,i as es,h as ts,D as A,C as ns}from"./index-CrsUVmPt.js";const Z=[{id:1,name:"Human",icon:A.human},{id:2,name:"Orc",icon:A.orc},{id:4,name:"Night Elf",icon:A.elf},{id:8,name:"Undead",icon:A.undead},{id:0,name:"Random",icon:A.random}],W={US:"United States",DE:"Germany",RU:"Russia",CN:"China",KR:"Korea",FR:"France",GB:"United Kingdom",PL:"Poland",BR:"Brazil",CA:"Canada",AU:"Australia",NL:"Netherlands",SE:"Sweden",ES:"Spain",IT:"Italy",UA:"Ukraine",CZ:"Czech Republic",AT:"Austria",BE:"Belgium",FI:"Finland",NO:"Norway",DK:"Denmark",CH:"Switzerland",PT:"Portugal",RO:"Romania",HU:"Hungary",GR:"Greece",SK:"Slovakia",BG:"Bulgaria",HR:"Croatia",RS:"Serbia",SI:"Slovenia",LT:"Lithuania",LV:"Latvia",EE:"Estonia",BY:"Belarus",KZ:"Kazakhstan",TW:"Taiwan",JP:"Japan",VN:"Vietnam",TH:"Thailand",PH:"Philippines",MY:"Malaysia",SG:"Singapore",ID:"Indonesia",IN:"India",PK:"Pakistan",TR:"Turkey",IL:"Israel",SA:"Saudi Arabia",AE:"UAE",EG:"Egypt",ZA:"South Africa",MX:"Mexico",AR:"Argentina",CL:"Chile",CO:"Colombia",PE:"Peru",VE:"Venezuela",NZ:"New Zealand"},cs=({leagueCounts:n,selectedLeague:i,onLeagueClick:d,filterLabels:c,isLoading:p})=>{const a=Object.values(n).reduce((e,t)=>e+t,0),r=Math.max(...Object.values(n),1);return p||a===0?s.jsxs("div",{className:"stats-card",children:[s.jsxs("div",{className:"stats-card-header",children:[s.jsx("h2",{className:"stats-card-title",children:"League Distribution"}),(c==null?void 0:c.length)>0&&s.jsx("div",{className:"stats-card-meta",children:c.map((e,t)=>s.jsx("span",{className:"stats-card-filter",children:e},t))})]}),s.jsx("div",{className:"stats-loading",children:p?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"loader-spinner"}),s.jsx("span",{className:"loader-text",children:"Loading"})]}):"No data"})]}):s.jsxs("div",{className:"stats-card",children:[s.jsxs("div",{className:"stats-card-header",children:[s.jsx("h2",{className:"stats-card-title",children:"League Distribution"}),s.jsxs("div",{className:"stats-card-meta",children:[c==null?void 0:c.map((e,t)=>s.jsx("span",{className:"stats-card-filter",children:e},t)),s.jsxs("span",{className:"stats-card-subtitle",children:[a.toLocaleString()," players"]})]})]}),s.jsx("div",{className:"stats-bars",children:R.map(e=>{const t=n[e.id]||0,o=a>0?(t/a*100).toFixed(1):0,S=r>0?t/r*100:0,v=i===e.id;return s.jsxs("div",{className:`stats-row clickable ${v?"selected":""}`,onClick:()=>d(e.id),children:[s.jsxs("div",{className:"stats-label",children:[s.jsx("img",{src:e.icon,alt:"",className:"stats-icon"}),s.jsx("span",{className:"stats-item-name",children:e.name})]}),s.jsx("div",{className:"stats-bar-container",children:s.jsx("div",{className:`stats-bar league-${e.id}`,style:{width:`${S}%`}})}),s.jsxs("div",{className:"stats-values",children:[s.jsx("span",{className:"stats-count",children:t.toLocaleString()}),s.jsxs("span",{className:"stats-percent",children:[o,"%"]})]})]},e.id)})}),i!==null&&s.jsx("button",{className:"stats-clear-filter",onClick:()=>d(null),children:"Clear filter"})]})},rs=({raceCounts:n,selectedRace:i,onRaceClick:d,filterLabels:c,isLoading:p})=>{const a=Object.values(n).reduce((e,t)=>e+t,0),r=Math.max(...Object.values(n),1);return p||a===0?s.jsxs("div",{className:"stats-card",children:[s.jsxs("div",{className:"stats-card-header",children:[s.jsx("h2",{className:"stats-card-title",children:"Race Distribution"}),c.length>0&&s.jsx("div",{className:"stats-card-meta",children:c.map((e,t)=>s.jsx("span",{className:"stats-card-filter",children:e},t))})]}),s.jsx("div",{className:"stats-loading",children:p?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"loader-spinner"}),s.jsx("span",{className:"loader-text",children:"Loading"})]}):"No data"})]}):s.jsxs("div",{className:"stats-card",children:[s.jsxs("div",{className:"stats-card-header",children:[s.jsx("h2",{className:"stats-card-title",children:"Race Distribution"}),s.jsxs("div",{className:"stats-card-meta",children:[c.map((e,t)=>s.jsx("span",{className:"stats-card-filter",children:e},t)),s.jsxs("span",{className:"stats-card-subtitle",children:[a.toLocaleString()," players"]})]})]}),s.jsx("div",{className:"stats-bars",children:Z.map(e=>{const t=n[e.id]||0,o=a>0?(t/a*100).toFixed(1):0,S=r>0?t/r*100:0,v=i===e.id;return s.jsxs("div",{className:`stats-row clickable ${v?"selected":""}`,onClick:()=>d(e.id),children:[s.jsxs("div",{className:"stats-label",children:[s.jsx("img",{src:e.icon,alt:"",className:"stats-icon race-icon"}),s.jsx("span",{className:"stats-item-name",children:e.name})]}),s.jsx("div",{className:"stats-bar-container",children:s.jsx("div",{className:`stats-bar race-${e.id}`,style:{width:`${S}%`}})}),s.jsxs("div",{className:"stats-values",children:[s.jsx("span",{className:"stats-count",children:t.toLocaleString()}),s.jsxs("span",{className:"stats-percent",children:[o,"%"]})]})]},e.id)})}),i!==null&&s.jsx("button",{className:"stats-clear-filter",onClick:()=>d(null),children:"Clear filter"})]})},ls=({countryCounts:n,selectedCountry:i,onCountryClick:d,filterLabels:c,isLoading:p})=>{const a=u.useMemo(()=>Object.entries(n).filter(([t,o])=>o>0).sort((t,o)=>o[1]-t[1]).slice(0,10),[n]),r=a.reduce((t,[o,S])=>t+S,0),e=a.length>0?a[0][1]:1;return p||a.length===0?s.jsxs("div",{className:"stats-card",children:[s.jsxs("div",{className:"stats-card-header",children:[s.jsx("h2",{className:"stats-card-title",children:"Top Countries"}),c.length>0&&s.jsx("div",{className:"stats-card-meta",children:c.map((t,o)=>s.jsx("span",{className:"stats-card-filter",children:t},o))})]}),s.jsx("div",{className:"stats-loading",children:p?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"loader-spinner"}),s.jsx("span",{className:"loader-text",children:"Loading"})]}):"No data"})]}):s.jsxs("div",{className:"stats-card",children:[s.jsxs("div",{className:"stats-card-header",children:[s.jsx("h2",{className:"stats-card-title",children:"Top Countries"}),s.jsxs("div",{className:"stats-card-meta",children:[c.map((t,o)=>s.jsx("span",{className:"stats-card-filter",children:t},o)),s.jsxs("span",{className:"stats-card-subtitle",children:[r.toLocaleString()," players"]})]})]}),s.jsx("div",{className:"stats-bars",children:a.map(([t,o])=>{const S=r>0?(o/r*100).toFixed(1):0,v=e>0?o/e*100:0,C=W[t]||t,F=i===t;return s.jsxs("div",{className:`stats-row clickable ${F?"selected":""}`,onClick:()=>d(t),children:[s.jsxs("div",{className:"stats-label",children:[s.jsx(ns,{name:t.toLowerCase(),className:"stats-flag"}),s.jsx("span",{className:"stats-item-name",children:C})]}),s.jsx("div",{className:"stats-bar-container",children:s.jsx("div",{className:"stats-bar country-bar",style:{width:`${v}%`}})}),s.jsxs("div",{className:"stats-values",children:[s.jsx("span",{className:"stats-count",children:o.toLocaleString()}),s.jsxs("span",{className:"stats-percent",children:[S,"%"]})]})]},t)})}),i!==null&&s.jsx("button",{className:"stats-clear-filter",onClick:()=>d(null),children:"Clear filter"})]})},is=({mmrData:n,isLoading:i})=>{var P,w,L,E,G,U;if(i||!((P=n==null?void 0:n.distributedMmrs)!=null&&P.length))return s.jsxs("div",{className:"stats-card",children:[s.jsx("div",{className:"stats-card-header",children:s.jsx("h2",{className:"stats-card-title",children:"MMR Distribution"})}),s.jsx("div",{className:"stats-loading",children:i?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"loader-spinner"}),s.jsx("span",{className:"loader-text",children:"Loading"})]}):"No data"})]});const{distributedMmrs:d,top2PercentIndex:c,top5PercentIndex:p,top10PercentIndex:a,top25PercentIndex:r,top50PercentIndex:e}=n,t=Math.max(...d.map(y=>y.count)),o=d.reduce((y,M)=>y+M.count,0),S=(w=d[c])==null?void 0:w.mmr,v=(L=d[p])==null?void 0:L.mmr,C=(E=d[a])==null?void 0:E.mmr,F=(G=d[r])==null?void 0:G.mmr,T=(U=d[e])==null?void 0:U.mmr;return s.jsxs("div",{className:"stats-card stats-card-wide",children:[s.jsxs("div",{className:"stats-card-header",children:[s.jsx("h2",{className:"stats-card-title",children:"MMR Distribution"}),s.jsxs("span",{className:"stats-card-subtitle",children:[o.toLocaleString()," players"]})]}),s.jsxs("div",{className:"mmr-chart",children:[s.jsx("div",{className:"mmr-bars",children:d.map((y,M)=>{const D=t>0?y.count/t*100:0,O=M===c||M===p||M===a||M===r||M===e;return s.jsx("div",{className:`mmr-bar ${O?"percentile":""}`,style:{height:`${D}%`},title:`${y.mmr} MMR: ${y.count} players`},y.mmr)})}),s.jsxs("div",{className:"mmr-axis",children:[s.jsx("span",{children:"0"}),s.jsx("span",{children:"1000"}),s.jsx("span",{children:"2000"}),s.jsx("span",{children:"3000+"})]})]}),s.jsxs("div",{className:"mmr-percentiles",children:[s.jsxs("div",{className:"mmr-percentile",children:[s.jsx("span",{className:"mmr-percentile-label",children:"Top 50%"}),s.jsxs("span",{className:"mmr-percentile-value",children:[T,"+"]})]}),s.jsxs("div",{className:"mmr-percentile",children:[s.jsx("span",{className:"mmr-percentile-label",children:"Top 25%"}),s.jsxs("span",{className:"mmr-percentile-value",children:[F,"+"]})]}),s.jsxs("div",{className:"mmr-percentile",children:[s.jsx("span",{className:"mmr-percentile-label",children:"Top 10%"}),s.jsxs("span",{className:"mmr-percentile-value",children:[C,"+"]})]}),s.jsxs("div",{className:"mmr-percentile",children:[s.jsx("span",{className:"mmr-percentile-label",children:"Top 5%"}),s.jsxs("span",{className:"mmr-percentile-value",children:[v,"+"]})]}),s.jsxs("div",{className:"mmr-percentile",children:[s.jsx("span",{className:"mmr-percentile-label",children:"Top 2%"}),s.jsxs("span",{className:"mmr-percentile-value",children:[S,"+"]})]})]})]})},ds=({hoursData:n,isLoading:i})=>{const d=u.useMemo(()=>{if(!(n!=null&&n.length))return[];const a=n.find(e=>e.gameMode===4);if(!(a!=null&&a.timeslots))return[];const r={};return a.timeslots.forEach(e=>{const t=e.hours;r[t]=(r[t]||0)+e.games}),Array.from({length:24},(e,t)=>({hour:t,games:r[t]||0}))},[n]),c=Math.max(...d.map(a=>a.games),1),p=d.reduce((a,r)=>a+r.games,0);return i||d.length===0?s.jsxs("div",{className:"stats-card",children:[s.jsx("div",{className:"stats-card-header",children:s.jsx("h2",{className:"stats-card-title",children:"Popular Hours (UTC)"})}),s.jsx("div",{className:"stats-loading",children:i?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"loader-spinner"}),s.jsx("span",{className:"loader-text",children:"Loading"})]}):"No data"})]}):s.jsxs("div",{className:"stats-card",children:[s.jsxs("div",{className:"stats-card-header",children:[s.jsx("h2",{className:"stats-card-title",children:"Popular Hours (UTC)"}),s.jsxs("span",{className:"stats-card-subtitle",children:[p.toLocaleString()," games"]})]}),s.jsxs("div",{className:"hours-chart",children:[s.jsx("div",{className:"hours-bars",children:d.map(a=>{const r=c>0?a.games/c*100:0;return s.jsx("div",{className:"hours-bar",style:{height:`${r}%`},title:`${a.hour}:00 - ${a.games.toLocaleString()} games`},a.hour)})}),s.jsxs("div",{className:"hours-axis",children:[s.jsx("span",{children:"0"}),s.jsx("span",{children:"6"}),s.jsx("span",{children:"12"}),s.jsx("span",{children:"18"}),s.jsx("span",{children:"24"})]})]})]})},os=({lengthData:n,isLoading:i})=>{const d=u.useMemo(()=>{if(!(n!=null&&n.length))return[];const a=n.find(e=>e.gameMode===4);if(!(a!=null&&a.lengths))return[];const r={};return a.lengths.forEach(e=>{const t=Math.floor(e.seconds/60),o=Math.floor(t/5)*5;o<=60&&(r[o]=(r[o]||0)+e.games)}),Object.entries(r).map(([e,t])=>({minutes:parseInt(e),games:t})).sort((e,t)=>e.minutes-t.minutes)},[n]),c=Math.max(...d.map(a=>a.games),1),p=d.reduce((a,r)=>a+r.games,0);return i||d.length===0?s.jsxs("div",{className:"stats-card",children:[s.jsx("div",{className:"stats-card-header",children:s.jsx("h2",{className:"stats-card-title",children:"Game Length"})}),s.jsx("div",{className:"stats-loading",children:i?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"loader-spinner"}),s.jsx("span",{className:"loader-text",children:"Loading"})]}):"No data"})]}):s.jsxs("div",{className:"stats-card",children:[s.jsxs("div",{className:"stats-card-header",children:[s.jsx("h2",{className:"stats-card-title",children:"Game Length"}),s.jsxs("span",{className:"stats-card-subtitle",children:[p.toLocaleString()," games"]})]}),s.jsxs("div",{className:"length-chart",children:[s.jsx("div",{className:"length-bars",children:d.map(a=>{const r=c>0?a.games/c*100:0;return s.jsx("div",{className:"length-bar",style:{height:`${r}%`},title:`${a.minutes}-${a.minutes+5} min: ${a.games.toLocaleString()} games`},a.minutes)})}),s.jsxs("div",{className:"length-axis",children:[s.jsx("span",{children:"0m"}),s.jsx("span",{children:"15m"}),s.jsx("span",{children:"30m"}),s.jsx("span",{children:"45m"}),s.jsx("span",{children:"60m"})]})]})]})},ms=n=>n?`/maps/${n.replace(/^\(\d\)/,"").replace(/ /g,"").replace(/'/g,"")}.png`:null,hs=({mapData:n,selectedSeason:i,isLoading:d})=>{const c=u.useMemo(()=>{if(!(n!=null&&n.length))return[];const a=n.find(e=>e.season===i);if(!(a!=null&&a.matchesOnMapPerModes))return[];const r=a.matchesOnMapPerModes.find(e=>e.gameMode===4);return r!=null&&r.maps?r.maps.sort((e,t)=>t.count-e.count):[]},[n,i]);c.length>0&&c[0].count;const p=c.reduce((a,r)=>a+r.count,0);return d||c.length===0?s.jsxs("div",{className:"stats-card",children:[s.jsx("div",{className:"stats-card-header",children:s.jsx("h2",{className:"stats-card-title",children:"Map Popularity"})}),s.jsx("div",{className:"stats-loading",children:d?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"loader-spinner"}),s.jsx("span",{className:"loader-text",children:"Loading"})]}):"No data"})]}):s.jsxs("div",{className:"stats-card stats-card-wide",children:[s.jsxs("div",{className:"stats-card-header",children:[s.jsx("h2",{className:"stats-card-title",children:"Map Popularity"}),s.jsxs("span",{className:"stats-card-subtitle",children:[c.length," maps · ",p.toLocaleString()," games"]})]}),s.jsx("div",{className:"map-grid",children:c.map((a,r)=>{const e=p>0?(a.count/p*100).toFixed(1):0,t=a.mapName||a.map.replace(/^\(\d\)/,"").replace(/^\d+/,"").trim(),o=ms(t);return s.jsxs("div",{className:"map-grid-item",children:[s.jsxs("div",{className:"map-grid-rank",children:["#",r+1]}),s.jsx("img",{src:o,alt:t,className:"map-grid-image",onError:S=>{S.target.style.opacity="0.3"}}),s.jsxs("div",{className:"map-grid-info",children:[s.jsx("span",{className:"map-grid-name",children:t}),s.jsxs("span",{className:"map-grid-stats",children:[a.count.toLocaleString()," · ",e,"%"]})]})]},a.map)})})]})},V=n=>{const i=`statsPage:${n}`;return k.get(i)},us=()=>k.get("w3cStats"),ps=()=>{const n=us(),[i,d]=u.useState(null),[c,p]=u.useState(null),[a,r]=u.useState(null),[e,t]=u.useState(null),[o,S]=u.useState([]),[v,C]=u.useState({}),[F,T]=u.useState({}),[P,w]=u.useState(!0),[L,E]=u.useState(null),[G,U]=u.useState((n==null?void 0:n.hours)||null),[y,M]=u.useState((n==null?void 0:n.lengths)||null),[D,O]=u.useState((n==null?void 0:n.maps)||null),[H,K]=u.useState(!n);u.useEffect(()=>{(async()=>{try{const h=await as();if(h&&h.length>0){S(h);const m=h[0].id;d(m);const x=V(m);x&&(C(x.leagueData||{}),T(x.countries||{}),E(x.mmrData||null),w(!1))}}catch(h){console.error("Failed to fetch seasons:",h),d(24)}})()},[]),u.useEffect(()=>{(async()=>{K(!n);try{const[h,m,x]=await Promise.all([fetch("https://website-backend.w3champions.com/api/w3c-stats/popular-hours"),fetch("https://website-backend.w3champions.com/api/w3c-stats/games-lengths"),fetch("https://website-backend.w3champions.com/api/w3c-stats/matches-on-map")]),[j,b,N]=await Promise.all([h.json(),m.json(),x.json()]);U(j),M(b),O(N),k.set("w3cStats",{hours:j,lengths:b,maps:N},6e5)}catch(h){console.error("Failed to fetch W3C stats:",h)}finally{K(!1)}})()},[]),u.useEffect(()=>{if(i===null)return;(async()=>{const h=`mmrDist:${i}`,m=k.get(h);m&&E(m);try{const j=await(await fetch(`https://website-backend.w3champions.com/api/w3c-stats/mmr-distribution?season=${i}&gateWay=${es}&gameMode=4`)).json();E(j),k.set(h,j,600*1e3)}catch(x){console.error("Failed to fetch MMR distribution:",x)}})()},[i]),u.useEffect(()=>{if(i===null)return;const l=`statsPage:${i}`;(async()=>{const m=V(i);m?(C(m.leagueData||{}),T(m.countries||{}),w(!1)):w(!0);const x={};try{const j=R.map(async g=>{const f=await ts(g.id,i);return{id:g.id,players:Array.isArray(f)?f:[]}});(await Promise.all(j)).forEach(({id:g,players:f})=>{x[g]=f}),C(x);const N={};Object.values(x).flat().forEach(g=>{var I,$;const f=($=(I=g.playersInfo)==null?void 0:I[0])==null?void 0:$.location;f&&(N[f]=(N[f]||0)+1)}),T(N),k.set(l,{leagueData:x,countries:N,mmrData:L},300*1e3)}catch(j){console.error("Failed to fetch league data:",j)}finally{w(!1)}})()},[i]);const B=(l,{skipLeague:h,skipRace:m,skipCountry:x}={})=>{var N,g,f,I,$;const j=((N=l.player)==null?void 0:N.race)??((f=(g=l.playersInfo)==null?void 0:g[0])==null?void 0:f.calculatedRace),b=($=(I=l.playersInfo)==null?void 0:I[0])==null?void 0:$.location;return!(!m&&a!==null&&j!==a||!x&&e!==null&&b!==e)},_=u.useMemo(()=>{const l={};return R.forEach(h=>{const m=v[h.id]||[];l[h.id]=m.filter(x=>B(x,{skipLeague:!0})).length}),l},[v,a,e]),Y=u.useMemo(()=>{const l={0:0,1:0,2:0,4:0,8:0};return(c!==null?[c]:R.map(m=>m.id)).forEach(m=>{(v[m]||[]).forEach(j=>{var N,g,f;if(!B(j,{skipRace:!0}))return;const b=((N=j.player)==null?void 0:N.race)??((f=(g=j.playersInfo)==null?void 0:g[0])==null?void 0:f.calculatedRace);b!==void 0&&l.hasOwnProperty(b)&&l[b]++})}),l},[v,c,e]),J=u.useMemo(()=>{const l={};return(c!==null?[c]:R.map(m=>m.id)).forEach(m=>{(v[m]||[]).forEach(j=>{var N,g;if(!B(j,{skipCountry:!0}))return;const b=(g=(N=j.playersInfo)==null?void 0:N[0])==null?void 0:g.location;b&&(l[b]=(l[b]||0)+1)})}),l},[v,c,a]),z=l=>{var m,x;const h=[];return l!=="league"&&c!==null&&h.push((m=R.find(j=>j.id===c))==null?void 0:m.name),l!=="race"&&a!==null&&h.push((x=Z.find(j=>j.id===a))==null?void 0:x.name),l!=="country"&&e!==null&&h.push(W[e]||e),h.filter(Boolean)},X=l=>{d(parseInt(l.target.value,10)),p(null),r(null),t(null)},q=l=>{p(c===l?null:l)},Q=l=>{r(a===l?null:l)},ss=l=>{t(e===l?null:l)};return s.jsxs("div",{className:"stats-page",children:[s.jsxs("div",{className:"stats-header",children:[s.jsx("h1",{className:"stats-title",children:"4v4 Statistics"}),s.jsx("div",{className:"stats-controls",children:s.jsx("div",{className:"season-selector",children:s.jsx("select",{id:"season-select",value:i||"",onChange:X,children:o.map(l=>s.jsxs("option",{value:l.id,children:["S",l.id]},l.id))})})})]}),s.jsxs("div",{className:"stats-grid",children:[s.jsx(cs,{leagueCounts:_,selectedLeague:c,onLeagueClick:q,filterLabels:z("league"),isLoading:P}),s.jsx(rs,{raceCounts:Y,selectedRace:a,onRaceClick:Q,filterLabels:z("race"),isLoading:P}),s.jsx(ls,{countryCounts:J,selectedCountry:e,onCountryClick:ss,filterLabels:z("country"),isLoading:P})]}),s.jsxs("div",{className:"stats-grid two-col",style:{marginTop:"var(--space-4)"},children:[s.jsx(is,{mmrData:L,isLoading:!L}),s.jsx(hs,{mapData:D,selectedSeason:i,isLoading:H})]}),s.jsxs("div",{className:"stats-grid two-col",style:{marginTop:"var(--space-4)"},children:[s.jsx(ds,{hoursData:G,isLoading:H}),s.jsx(os,{lengthData:y,isLoading:H})]})]})};export{ps as default};
