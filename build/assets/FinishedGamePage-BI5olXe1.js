import{a as o,v as $,m as k,l as q,f as S,j as s,G as z,w as A,x as B}from"./index-HyVcIyen.js";const H=a=>S.get(`finishedMatchPlayers:${a}`),J=({data:a,compact:c=!1})=>{var g;const l=(g=a==null?void 0:a.match)==null?void 0:g.id,e=l?H(l):null,[h,d]=o.useState((e==null?void 0:e.playerData)||null),[m,I]=o.useState((e==null?void 0:e.metaData)||null),[M,E]=o.useState((e==null?void 0:e.profilePics)||{}),[v,F]=o.useState((e==null?void 0:e.countries)||{}),[L,U]=o.useState((e==null?void 0:e.sessions)||{}),[N,u]=o.useState(!e&&!c);o.useEffect(()=>{C()},[]);const C=async()=>{try{const n=b(a),{playerData:i,metaData:f}=n;d(i),I({...f,matchId:a.match.id}),c?u(!1):(e||u(!0),await G(i))}catch(n){console.error("Error fetching match data:",n.message),u(!1)}},b=n=>{if(!n)throw new Error("Invalid match data format");return $(n.match,n.playerScores)},G=async n=>{try{const i=n.map(async t=>{const{battleTag:r,race:p,location:T}=t,[w,R]=await Promise.all([k(r),q(r,p)]);return{...t,profilePicUrl:w.profilePicUrl,country:w.country||T,sessionInfo:R}}),f=await Promise.all(i),y=f.reduce((t,r)=>(t[r.battleTag]=r.profilePicUrl,t),{}),P=f.reduce((t,r)=>(t[r.battleTag]=r.country,t),{}),x=f.reduce((t,r)=>{var p;return t[r.battleTag]=(p=r.sessionInfo)==null?void 0:p.session,t},{});E(t=>({...t,...y})),F(t=>({...t,...P})),U(t=>({...t,...x})),l&&S.set(`finishedMatchPlayers:${l}`,{playerData:n,metaData:{...m,matchId:l},profilePics:y,countries:P,sessions:x},1800*1e3)}catch(i){console.error("Error fetching player data:",i)}finally{u(!1)}};return s.jsx(s.Fragment,{children:N?s.jsxs("div",{className:"page-loader",children:[s.jsx("div",{className:"loader-spinner lg"}),s.jsx("span",{className:"loader-text",children:"Loading match data"})]}):h?s.jsx(z,{playerData:h,metaData:m,profilePics:M,playerCountries:v,sessionData:L,compact:c}):s.jsx("div",{children:"Error: Failed to load match data"})})},D=()=>new URL(window.location.href).pathname.split("/").slice(-1)[0],j=()=>{const a=D();return B(a)},O=()=>{const[a,c]=o.useState(j),[l,e]=o.useState(()=>j()===null);o.useEffect(()=>{h()},[]);const h=async()=>{try{const d=D(),m=await A(d);c(m),e(!1)}catch(d){console.error("Error fetching match data:",d.message),e(!1)}};return s.jsx(s.Fragment,{children:l?s.jsxs("div",{className:"page-loader",children:[s.jsx("div",{className:"loader-spinner lg"}),s.jsx("span",{className:"loader-text",children:"Loading match data"})]}):a?s.jsx(J,{data:a}):s.jsx("div",{children:"Error: Failed to load match data"})})};export{O as default};
