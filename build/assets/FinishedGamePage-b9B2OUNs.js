import{r as n,T as v,U as L,a as P,j as a,V as N,d as F,m as G,Q as U,W as C}from"./index-Ck5R6zb5.js";const O=s=>P.get(`finishedMatchPlayers:${s}`),R=({data:s,compact:o=!1})=>{var y;const c=(y=s==null?void 0:s.match)==null?void 0:y.id,e=c?O(c):null,[m,h]=n.useState((e==null?void 0:e.playerData)||null),[f,d]=n.useState((e==null?void 0:e.metaData)||null),[t,g]=n.useState((e==null?void 0:e.profilePics)||{}),[p,S]=n.useState((e==null?void 0:e.countries)||{}),[D,M]=n.useState((e==null?void 0:e.sessions)||{}),[w,u]=n.useState(!e&&!o);n.useEffect(()=>{E()},[]);const E=async()=>{try{if(!s)throw new Error("Invalid match data format");const l=v(s.match,s.playerScores),{playerData:r,metaData:i}=l;h(r),d({...i,matchId:s.match.id}),o?u(!1):(e||u(!0),await I(r))}catch(l){console.error("Error fetching match data:",l.message),u(!1)}},I=async l=>{try{const r=await L(l,{fetchSessions:!0,fetchTwitchStatus:!1});g(i=>({...i,...r.profilePics})),S(i=>({...i,...r.countries})),M(i=>({...i,...r.sessions})),c&&P.set(`finishedMatchPlayers:${c}`,{playerData:l,metaData:{...f,matchId:c},profilePics:r.profilePics,countries:r.countries,sessions:r.sessions},1800*1e3)}catch(r){console.error("Error fetching player data:",r)}finally{u(!1)}};return a.jsx(a.Fragment,{children:w?a.jsxs("div",{className:"page-loader",children:[a.jsx("div",{className:"loader-spinner lg"}),a.jsx("span",{className:"loader-text",children:"Loading match data"})]}):m?a.jsx(N,{playerData:m,metaData:f,profilePics:t,playerCountries:p,sessionData:D,compact:o}):a.jsx("div",{children:"Error: Failed to load match data"})})},j=()=>new URL(window.location.href).pathname.split("/").slice(-1)[0],x=()=>{const s=j(),o=C(s);return o!=null&&o.match?o:null},$=()=>{const[s,o]=n.useState(x),[c,e]=n.useState(null),[m,h]=n.useState(()=>x()===null);n.useEffect(()=>{f()},[]);const f=async()=>{const d=j();try{const t=await F(d);if(t!=null&&t.match){o(t),h(!1);return}}catch(t){console.error("Error fetching finished match:",t.message)}try{const t=await G(),g=((t==null?void 0:t.matches)||[]).find(p=>p.id===d);if(g){e(g),h(!1);return}}catch(t){console.error("Error fetching ongoing matches:",t.message)}h(!1)};return a.jsx("div",{className:"match-page",children:m?a.jsxs("div",{className:"page-loader",children:[a.jsx("div",{className:"loader-spinner lg"}),a.jsx("span",{className:"loader-text",children:"Loading match data"})]}):s!=null&&s.match?a.jsx(R,{data:s}):c?a.jsx(U,{ongoingGameData:c}):a.jsx("div",{children:"Error: Failed to load match data"})})};export{$ as default};
