import{a as P,m as j,l as D,i as R,T as k,j as $}from"./index-DRkeA8z1.js";import{P as C}from"./PlayerOverlay-BBiH_xWj.js";const T=async p=>{try{const s=p.toLowerCase(),c=`https://website-backend.w3champions.com/api/ladder/search?gateWay=${R}&searchFor=${encodeURIComponent(p.split("#")[0])}&gameMode=4&season=${k}`,o=await fetch(c);if(!o.ok)return null;const l=(await o.json()).find(a=>{var i,m,y,d,g,f,w;const t=(y=(m=(i=a.playersInfo)==null?void 0:i[0])==null?void 0:m.battleTag)==null?void 0:y.toLowerCase(),r=(w=(f=(g=(d=a.player)==null?void 0:d.playerIds)==null?void 0:g[0])==null?void 0:f.battleTag)==null?void 0:w.toLowerCase();return t===s||r===s});if(!l)return null;const n=l.league,h=l.rankNumber;let e=0;for(let a=0;a<n;a++)try{const t=`https://website-backend.w3champions.com/api/ladder/${a}?gateWay=${R}&gameMode=4&season=${k}`,r=await fetch(t);if(r.ok){const i=await r.json();e+=i.length}}catch{}return e+h}catch(s){return console.error("Error calculating overall rank:",s),null}},x=async p=>{const s=[0,1,2,4,8],c=[];let o=[];try{const e=await fetch("https://website-backend.w3champions.com/api/ladder/seasons");e.ok&&(o=await e.json())}catch{o=[{id:k}]}const u=[];for(const e of o)for(const a of s)u.push(fetch(`https://website-backend.w3champions.com/api/players/${encodeURIComponent(p)}/mmr-rp-timeline?gateway=${R}&season=${e.id}&race=${a}&gameMode=4`).then(t=>t.ok?t.json():null).then(t=>(t==null?void 0:t.mmrRpAtDates)||[]).catch(()=>[]));const l=await Promise.all(u);for(const e of l)c.push(...e);const n={};for(const e of c)(!n[e.date]||e.mmr>n[e.date].mmr)&&(n[e.date]=e);return Object.values(n).sort((e,a)=>new Date(e.date)-new Date(a.date)).map(e=>e.mmr)},E=()=>{const[p,s]=P.useState(!1),[c,o]=P.useState(null),u=()=>{const a=new URL(window.location.href).pathname.split("/").slice(-1)[0];return decodeURIComponent(a)},l=()=>new URLSearchParams(window.location.search).get("bg")||"bg-gradient-fade",n=()=>new URLSearchParams(window.location.search).get("layout")||"default";P.useEffect(()=>{h();const e=setInterval(h,3e4);return()=>clearInterval(e)},[]);const h=async()=>{try{const e=u(),a=e.split("#")[0],[t,r,i,m,y]=await Promise.all([j(e),D(e),fetch(`https://website-backend.w3champions.com/api/players/${encodeURIComponent(e)}/game-mode-stats?gateway=${R}&season=${k}`),x(e),T(e)]),d=(r==null?void 0:r.session)||{};let g=0,f=0,w=0;if(i.ok){const b=(await i.json()).find(U=>U.gameMode===4);b&&(g=b.mmr||d.currentMmr||0,f=b.wins||0,w=b.losses||0)}const v=m.length>0?Math.max(...m):null,L=m.length>0?Math.min(...m):null;o({name:a,battleTag:e,profilePic:t==null?void 0:t.profilePicUrl,country:t==null?void 0:t.country,mmr:g,allTimeLow:L,allTimePeak:v,wins:f,losses:w,sessionChange:d.mmrChange||0,form:d.form||[],rank:y}),s(!0)}catch(e){console.error("Error loading player data:",e),s(!0)}};return $.jsx("div",{style:{background:"transparent",minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"},children:p&&c&&$.jsx(C,{playerData:c,layout:n(),bgStyle:l()})})};export{E as default};
