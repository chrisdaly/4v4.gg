const w="https://id.twitch.tv/oauth2/token",p="https://api.twitch.tv/helix/streams",l="ih2eh32bniif18yogcz0uxgwhcmhik",T="5w15g2pyy60q10x8xxxzizuxj1gowe";let i=null,c=0;const _=async()=>{if(i&&Date.now()<c)return i;try{const r=new URLSearchParams({client_id:l,client_secret:T,grant_type:"client_credentials"}),n=await fetch(w,{method:"POST",body:r});if(!n.ok)return console.warn("Twitch OAuth failed:",n.status),null;const t=await n.json();if(t!=null&&t.access_token)return i=t.access_token,c=Date.now()+(t.expires_in-300)*1e3,console.log("Twitch token acquired, expires in",Math.round(t.expires_in/3600),"hours"),i}catch(r){console.warn("Failed to get Twitch token:",r.message)}return null},f=async r=>{const n=new Map;if(!r||r.length===0)return n;const t=await _();if(!t)return n;try{const s=r.filter(e=>e&&typeof e=="string").map(e=>e.replace("https://twitch.tv/","").toLowerCase()).filter(e=>e.length>0);if(s.length===0)return n;const h=s.map(e=>`user_login=${encodeURIComponent(e)}`).join("&"),u=`${p}?first=100&${h}`,a=await fetch(u,{headers:{"Client-ID":l,Authorization:`Bearer ${t}`}});if(!a.ok)return console.warn("Twitch API error:",a.status),n;const o=await a.json();o!=null&&o.data&&o.data.forEach(e=>{n.set(e.user_name.toLowerCase(),{viewerCount:e.viewer_count,title:e.title,gameName:e.game_name,startedAt:e.started_at})})}catch(s){console.warn("Failed to check Twitch streams:",s.message)}return n},g=async r=>{const t=(await f([r])).get(r.toLowerCase());return t?{isLive:!0,...t}:{isLive:!1}};export{f as g,g as i};
